import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,o as n,d as e}from"./app-B5m7CcSj.js";const a={},l=e(`<h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><p><a href="https://www.jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a>官网列出了<a href="https://www.jenkins.io/doc/book/installing/" target="_blank" rel="noopener noreferrer">Jenkins的多种安装方式</a>，各有利弊，但相对来说<a href="https://www.jenkins.io/doc/book/installing/macos/" target="_blank" rel="noopener noreferrer">MacOS</a>下的安装最为简单和<a href="https://www.jenkins.io/download/thank-you-downloading-windows-installer-stable/" target="_blank" rel="noopener noreferrer">Windows</a>下的安装最为简单。</p><ul><li>官方给出了<a href="https://www.jenkins.io/doc/book/installing/docker/" target="_blank" rel="noopener noreferrer">Docker部署Jenkins</a>的完整脚本，脚本中很多都是不必要的，真正有用就是下面这一条。</li></ul><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; docker run --name jenkins </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    --restart</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">always</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 8080:8080</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5000:5000</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./jenkins:/var/jenkins_home</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    jenkins/jenkins</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以在<code>./jenkins</code>目录中准备一个名为<code>hudson.model.UpdateCenter.xml</code>的文件，这个文件是可选的，可以准备也可以不准备，其内容如下。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;?xml </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;1.1&#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;UTF-8&#39;?</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;sites&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">site</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">default</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/id&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;!</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 或者将http://updates.jenkins.io/current/update-center.json</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 替换为</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">http://updates.jenkins.io/current/update-center.json</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/url&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/site</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/sites&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后执行<a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">Docker</a>脚本就可以了。</p><p>或者把<a href="https://www.gitlab.com/" target="_blank" rel="noopener noreferrer">Gitlab</a>和<a href="https://www.jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a>整合到一起，提供一个统一的启动<a href="https://github.com/docker/compose" target="_blank" rel="noopener noreferrer">Docker Compose</a>脚本。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">version:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;3.6&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">services:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  jenkins:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    image:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> jenkins/jenkins:latest</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    container_name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> jenkins</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    user:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    restart:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> always</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    privileged:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ports:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 9528:9528</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 50000:50000</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    environment:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> TZ=Asia/Shanghai</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    volumes:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./data/:/var/jenkins_home/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/bin/docker:/usr/bin/docker</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/run/docker.sock:/var/run/docker.sock</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/docker/daemon.json:/etc/docker/daemon.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  gitlab:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    image:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gitlab/gitlab-ce:16.9.2-ce.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    container_name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gitlab</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    restart:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> always</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    hostname:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    environment:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      GITLAB_OMNIBUS_CONFIG:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        external_url</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;http://localhost:9529&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        gitlab_rails[</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;gitlab_shell_ssh_port&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">]</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2222</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ports:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 9529:9529</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 443:443</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2222:2222</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    volumes:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./config:/etc/gitlab</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./logs:/var/log/gitlab</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./data:/var/opt/gitlab</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    shm_size:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;256m&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在<a href="https://www.jenkins.io/doc/book/installing/macos/" target="_blank" rel="noopener noreferrer">MacOS</a>中安装<a href="https://www.jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a>只需要两条命令就可以搞定。</li></ul><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; brew install jenkins-lts</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; brew services start jenkins-lts</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>在<a href="https://www.jenkins.io/download/thank-you-downloading-windows-installer-stable/" target="_blank" rel="noopener noreferrer">Windows</a>中安装则只需要<a href="https://www.jenkins.io/download/thank-you-downloading-windows-installer-stable/" target="_blank" rel="noopener noreferrer">在这里下载</a><code>.exe</code>安装文件就行了，只不过安装过程中需要修改一些本地安全策略。</p><ul><li><p>以管理员权限登录计算机。</p></li><li><p>打开<code>管理工具</code>并打开<code>本地安全策略</code>。</p></li><li><p>展开<code>本地策略</code>并单击<code>用户权限分配</code>。</p></li><li><p>在右侧窗格中，右键单击<code>作为服务登录</code>并选择属性。</p></li><li><p>单击<code>添加用户或组(U)...</code>按钮来添加新用户。</p></li><li><p>在<code>选择用户或组</code>对话框中，找到要输入的用户，然后单击<code>确定</code>。</p></li><li><p>单击<code>作为服务登录</code>属性中的<code>确定</code>以保存更改。</p></li></ul></li></ul><p>如果不想这么麻烦，干脆选择<code>Run service as LocalSystem (not recommended)</code>就好了。</p><p>安装好之后就可以开始配置<a href="https://www.jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a>了。</p><br><h2 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h2><p><a href="https://www.jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a>通常需要配置两个组件。</p><ul><li><p>整合<a href="https://www.gitlab.com/" target="_blank" rel="noopener noreferrer">Gitlab</a>，抽取仓库中的代码。</p></li><li><p>整合<a href="https://maven.apache.org/" target="_blank" rel="noopener noreferrer">Maven</a>，编译、打包代码。</p></li></ul><p><a href="https://www.jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a>有两种编译构建模式，<code>Freestyle Job</code>和<code>Pineline Job</code>。</p><ul><li><p><code>Freestyle Job</code>，这是一种相对自由的<code>Job</code>，每次只能执行一个具体的任务，不需要编码，完全通过页面配置实现，但不利于后续管理维护，因为它都是散装的，且无法拼接。</p></li><li><p><code>Pineline Job</code>，这就是流水线任务，可以通过编码实现各种复杂的<code>编译</code>、<code>构建</code>、<code>打包</code>和<code>部署</code>逻辑，而且迁移、修改也很方便，但学习和维护成本较高。</p></li></ul>`,20),t=[l];function r(h,p){return n(),i("div",null,t)}const o=s(a,[["render",r],["__file","jenkins.html.vue"]]),c=JSON.parse('{"path":"/technology/cicd/pipeline/jenkins.html","title":"Jenkins","lang":"zh-CN","frontmatter":{"title":"Jenkins","icon":"hat-cowboy","category":["CI&CD","流水线"],"tag":["CI&CD","流水线","Jenkins"],"date":"2022-11-12T00:00:00.000Z","isOriginal":true,"star":true,"description":"安装 Jenkins官网列出了Jenkins的多种安装方式，各有利弊，但相对来说MacOS下的安装最为简单和Windows下的安装最为简单。 官方给出了Docker部署Jenkins的完整脚本，脚本中很多都是不必要的，真正有用就是下面这一条。 可以在./jenkins目录中准备一个名为hudson.model.UpdateCenter.xml的文件，这...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/technology/cicd/pipeline/jenkins.html"}],["meta",{"property":"og:site_name","content":"添码座"}],["meta",{"property":"og:title","content":"Jenkins"}],["meta",{"property":"og:description","content":"安装 Jenkins官网列出了Jenkins的多种安装方式，各有利弊，但相对来说MacOS下的安装最为简单和Windows下的安装最为简单。 官方给出了Docker部署Jenkins的完整脚本，脚本中很多都是不必要的，真正有用就是下面这一条。 可以在./jenkins目录中准备一个名为hudson.model.UpdateCenter.xml的文件，这..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"添码座"}],["meta",{"property":"article:tag","content":"CI&CD"}],["meta",{"property":"article:tag","content":"流水线"}],["meta",{"property":"article:tag","content":"Jenkins"}],["meta",{"property":"article:published_time","content":"2022-11-12T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Jenkins\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-11-12T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"添码座\\",\\"url\\":\\"https://www.tianmazuo.com/about/\\"}]}"]]},"headers":[{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":2,"title":"配置","slug":"配置","link":"#配置","children":[]}],"git":{},"readingTime":{"minutes":2.48,"words":745},"filePathRelative":"technology/cicd/pipeline/jenkins.md","localizedDate":"2022年11月12日","excerpt":"<h2>安装</h2>\\n<p><a href=\\"https://www.jenkins.io/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Jenkins</a>官网列出了<a href=\\"https://www.jenkins.io/doc/book/installing/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Jenkins的多种安装方式</a>，各有利弊，但相对来说<a href=\\"https://www.jenkins.io/doc/book/installing/macos/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">MacOS</a>下的安装最为简单和<a href=\\"https://www.jenkins.io/download/thank-you-downloading-windows-installer-stable/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Windows</a>下的安装最为简单。</p>","autoDesc":true}');export{o as comp,c as data};
