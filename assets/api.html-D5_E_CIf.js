import{_ as h}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as k,c as e,a as s,e as i,b as n,w as l,d as t,o as p}from"./app-B5m7CcSj.js";const r={},d=t('<h2 id="说明" tabindex="-1"><a class="header-anchor" href="#说明"><span>说明</span></a></h2><div class="hint-container warning"><p class="hint-container-title">注意</p><p>后续所有提到<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>的地方，指的都是<a href="https://openresty.org/" target="_blank" rel="noopener noreferrer">OpenResty</a>中的<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>，而不是原生的<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>。</p><p>完整的<code>API</code>指令可以参考这两个地方。</p><ul><li><p>API：<a href="https://github.com/openresty/lua-nginx-module?tab=readme-ov-file#nginx-api-for-lua" target="_blank" rel="noopener noreferrer">https://github.com/openresty/lua-nginx-module?tab=readme-ov-file#nginx-api-for-lua</a>。</p></li><li><p>API：<a href="https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/" target="_blank" rel="noopener noreferrer">https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/</a>。</p></li></ul></div><p><a href="https://www.lua.org/" target="_blank" rel="noopener noreferrer">Lua</a>最大的作用就是接收<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>收到的海量请求，处理后再输出响应结果。</p><ul><li><p>对于请求，无非就是接收参数（<code>parameter</code>）、解析请求头（<code>header</code>）和请求体（<code>body</code>）等信息。</p></li><li><p>对于处理，无非就是调用相应的功能代码，去读取诸如<a href="https://www.redis.io/" target="_blank" rel="noopener noreferrer">Redis</a>或<a href="https://www.mysql.com" target="_blank" rel="noopener noreferrer">MySQL</a>中的数据。</p></li><li><p>对于响应，无非就是输出响应的状态码、响应头和响应内容体。</p></li></ul><p>所谓<code>API</code>就是调用<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>中提供的内置变量和基本方法来完成响应请求、处理内容和输出数据。</p><p>而<code>模块</code>则是基于<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>插拔式的模块架构，实现对功能的扩展。</p><p><a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>可以通过三种方式引入<a href="https://www.lua.org/" target="_blank" rel="noopener noreferrer">Lua</a>。</p>',7),g=s("code",null,"xxx_by_lua",-1),F=s("code",null,"conf",-1),A=s("a",{href:"https://www.lua.org/",target:"_blank",rel:"noopener noreferrer"},"Lua",-1),y=s("code",null,"xxx_by_lua_block",-1),o=s("code",null,"xxx_by_lua_file",-1),c=s("a",{href:"https://www.lua.org/",target:"_blank",rel:"noopener noreferrer"},"Lua",-1),u=s("a",{href:"https://www.nginx.org/",target:"_blank",rel:"noopener noreferrer"},"Nginx",-1),B=t(`<p>上面的<code>xxx</code>表示不同的<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>模块指令。</p><br><h2 id="请求处理" tabindex="-1"><a class="header-anchor" href="#请求处理"><span>请求处理</span></a></h2><p><a href="https://www.lua.org/" target="_blank" rel="noopener noreferrer">Lua</a>常用的<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a><code>API</code>包括下面几个。</p><ul><li><p><code>ngx.var</code>：获取<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>中定义的变量和它的内置变量。</p></li><li><p><code>ngx.req</code>：<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>请求模块相关<code>API</code>。</p></li><li><p><code>ngx.header</code>：<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>响应头相关<code>API</code>。</p></li><li><p><code>ngx.time</code>：<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>时间相关<code>API</code>。</p></li><li><p><code>ngx.re</code>：<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>正则表达式相关<code>API</code>。</p></li></ul><p>还有一个高频使用的<code>ngx.say</code>。</p><p>获取<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>中定义的变量和它的内置变量（完整的<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>内置变量可以<a href="https://nginx.org/en/docs/varindex.html" target="_blank" rel="noopener noreferrer">参考这里</a>）。</p><p>先修改之前<code>lua.conf</code>中的内容。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; vi /usr/local/openresty/nginx/conf/lua.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    listen</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 9527</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    server_name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> _</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /request1/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\d+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">\\d+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">{</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # 声明两个nginx变量</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        set</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $a</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> $1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        set</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $b</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        default_type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;text/html&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # 关闭lua代码编译缓存，让lua文件实时生效（生产环境最好是on）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        lua_code_cache</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # 调用test_api.lua脚本</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        content_by_lua_file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> conf/lua/test_api.lua</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # 内容体处理完成后调用</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        echo_after_body</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;ngx.var.b </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$b</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /request2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        default_type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;text/html&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        lua_code_cache</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        content_by_lua_block</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.header.content_type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;text/html&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.header.first_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;hello nginx&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.header.second_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;hello openresty&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.header[</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;third_header&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">]</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;hello lua&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.header[</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;forth_header&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">]</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {&quot;key1=a;value=1&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;key2=b;value=2&quot;}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> header</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">get_headers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> k, v in pairs(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">header</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                ngx.say(string.format(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;Header name: %s, value: %s&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> k,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            end</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后在<code>/usr/local/openresty/nginx/conf/lua</code>文件夹中创建一个名为<code>test_api.lua</code>的文件，并输入下面的内容。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cd /usr/local/openresty/nginx/conf/lua</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; vi test_api.lua</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 声明nginx变量</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== var begin ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> var</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">var</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.var.b</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;ngx.var.a ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> var.a,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;ngx.var.b ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> var.b,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;ngx.var[2] ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> var[2],</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== var begin ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 处理请求头</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== headers begin ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> headers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">get_headers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $arg_name表示名为name的参数</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">，如果有age参数，那么同样可以用ngx.var.arg_age获取它的值</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$arg_name</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.arg_name,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$args</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.args,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$binary_remote_addr</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.binary_remote_addr,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$body_bytes_sent</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.body_bytes_sent,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$content_length</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.content_length,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$content_type</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.content_type,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$content_type</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.content_type,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$uri</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.uri,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$document_uri</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.document_uri,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$host</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.host,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$hostnamet</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.hostname,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$http_cookie</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.http_cookie,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$http_referer</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.http_referer,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$http_user_agent</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.http_user_agent,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$http_via</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.http_via,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$http_x_forwarded_for</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.http_x_forwarded_for,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$is_args</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.is_args,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$limit_rate</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.limit_rate,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$nginx_version</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.nginx_version,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$pid</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.pid,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$query_string</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.query_string,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$realpath_root</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.realpath_root,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$remote_addr</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.remote_addr,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$remote_port</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.remote_port,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$remote_user</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.remote_user,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$request</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.request,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$request_body</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.request_body,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$request_body_file</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.request_body_file,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$request_completion</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.request_completion,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$request_filename</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.request_filename,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$request_method</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.request_method,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$request_uri</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.request_uri,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$scheme</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.scheme,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$server_addr</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.server_addr,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$server_name</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.server_name,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$server_port</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.server_port,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$server_protocol</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.var.server_protocol,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;Host ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> headers[&quot;Host&quot;],</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;user-agent ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> headers[&quot;user-agent&quot;],</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 另一种访问数据的方法</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;user-agent ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> headers.user_agent,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> k, v in pairs(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">headers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">v</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) == </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;table&quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx.say(k,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> table.concat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">v,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;,&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  else</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx.say(k,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot; : &quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== headers end ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 获取GET方法的全部请求参数</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== GET uri args begin ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> uri_args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">get_uri_args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> k, v in pairs(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">uri_args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">v</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) == </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;table&quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx.say(k,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot; : &quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> table.concat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">v,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;, &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  else</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx.say(k,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;: &quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== GET uri args end ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 获取POST方法的全部请求参数</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== POST args begin ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.req.read_body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> post_args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">get_post_args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> k, v in pairs(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">post_args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">v</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) == </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;table&quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx.say(k,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> table.concat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">v,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;, &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  else</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx.say(k,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;: &quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== POST args end ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 请求的http协议版本</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;ngx.req.http_version ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.req.http_version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 请求方法</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;ngx.req.get_method ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.req.get_method</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 原始的请求头内容</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;ngx.req.raw_header ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.req.raw_header</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 请求的body内容体</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;ngx.req.get_body_data() ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.req.get_body_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 获取时间</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== time begin ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> t1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">now</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> i = 1, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000000</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> do</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.update_time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> t2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">now</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(t1,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot; , &quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> t2,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time_now</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> formatted_time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">os</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">date</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;%Y-%m-%d %H:%M:%S %p&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> time_now</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;current time ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> formatted_time,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== time end ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 编码解码</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== encode decode begin ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> request_uri</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">var</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">request_uri</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MD5</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;ngx.md5(&#39;123456&#39;) ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.md5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;123456&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br/&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 编码</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> escape_code</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">escape_uri</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">request_uri</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;encode request_uri ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.escape_uri</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">request_uri</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br/&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 解码</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;decode request_uri ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.unescape_uri</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">escape_code</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br/&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 参数编码</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> pos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">find</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">request_uri,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;?&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> pos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> then</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> uri</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sub</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">request_uri,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pos</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;uri sub = &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> string.sub</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">request_uri,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pos</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br/&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    --</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 对字符串解码</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">decode_args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">string.sub(request_uri,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pos</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> k,v in pairs(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;k = &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> k,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;, v = &quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br/&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> args</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> args.userId</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        args.userId</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> args.userId</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10000</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;args + 10000 : &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uri</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;?&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.encode_args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br/&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== encode decode end ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 正则表达式</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== regexp begin ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">re</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">match</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;hello, 123456&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;[0-9]+&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> m</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    --</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 打印出123456</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;regexp ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> m[0]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> err</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        --</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 打印日志</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ngx.log(ngx.ERR,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;error ==&gt; &quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;未找到匹配项&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;====== regexp end ======&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;&lt;br&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>把这个地址<a href="http://xn--IP-fr5c86lx7z:9527/request1/1/2?a=3&amp;b=4&amp;name=lixingyun" target="_blank" rel="noopener noreferrer">http://服务器IP:9527/request1/1/2?a=3&amp;b=4&amp;name=lixingyun</a>放在浏览器中访问，和用<a href="https://www.postman.com/" target="_blank" rel="noopener noreferrer">Postman</a>工具以<code>POST</code>方式调用它，输出的内容会有很多不同。</p><p>然后访问<a href="http://xn--IP-fr5c86lx7z:9527/request2" target="_blank" rel="noopener noreferrer">http://服务器IP:9527/request2</a>就能得到<code>HTTP</code>头输出的内容。</p><br><h2 id="重定向与数据共享" tabindex="-1"><a class="header-anchor" href="#重定向与数据共享"><span>重定向与数据共享</span></a></h2><p>接下来是<code>ngx.redirect</code>和<code>ngx.ctx</code>。</p><ul><li><p><code>ngx.redirect</code>：<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>重定向<code>API</code>。</p></li><li><p><code>ngx.ctx</code>：<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>上下文变量共享相关<code>API</code>。</p></li><li><p><code>ngx.shared</code>：<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>内存共享相关<code>API</code>。</p></li></ul><p>修改<code>/usr/local/openresty/nginx/conf/nginx.conf</code>文件。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; vi /usr/local/openresty/nginx/conf/nginx.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 在http部分分配共享内存大小</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lua_shared_dict</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> global_shared</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改<code>lua.conf</code>文件，输入下面的内容。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; vi /usr/local/openresty/nginx/conf/lua.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    listen</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 9527</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    server_name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> _</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /test1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        default_type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;text/html&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        lua_code_cache</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        content_by_lua_block</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.say([[this</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test1]]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /test2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        default_type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;text/html&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        lua_code_cache</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        rewrite_by_lua_block</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.redirect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;/test1&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # 通过ngx.ctx实现共享</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /test3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        default_type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;text/html&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        lua_code_cache</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        rewrite_by_lua_block</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.ctx.data</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        access_by_lua_block</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.ctx.data</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ngx.ctx.data</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        content_by_lua_block</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.say(ngx.ctx.data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # 通过ngx.shared实现共享</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /test4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        default_type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;text/html&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        lua_code_cache</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        content_by_lua_block</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> global_shared</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ngx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">shared</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">global_shared</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">global_shared</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;data&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> not</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> data</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                data</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                global_shared:set(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;data&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                --</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 输出</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> data</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;data ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> data,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br/&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            end</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            data</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> global_shared:incr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;data&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            --</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 输出</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> data</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.say(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;data ==&gt; &quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> data,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&lt;br/&gt;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在浏览器中访问<a href="http://xn--IP-fr5c86lx7z:9527/test2" target="_blank" rel="noopener noreferrer">http://服务器IP:9527/test2</a>，会发现地址栏和页面已经被重定向到了<a href="http://xn--IP-fr5c86lx7z:9527/test1" target="_blank" rel="noopener noreferrer">http://服务器IP:9527/test1</a>。</p><p>而访问<a href="http://xn--IP-fr5c86lx7z:9527/test3" target="_blank" rel="noopener noreferrer">http://服务器IP:9527/test3</a>之后，页面上打印出了<code>2</code>。</p><br><h2 id="日志" tabindex="-1"><a class="header-anchor" href="#日志"><span>日志</span></a></h2><p>最后是<code>ngx.log</code>。</p><ul><li><code>ngx.log</code>：<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>日志<code>API</code>。</li></ul><p><a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>中定义的日志级别如下。</p><table><thead><tr><th style="text-align:center;">级别</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">ngx.EMERG</td><td style="text-align:left;">紧急事故</td></tr><tr><td style="text-align:center;">ngx.CRIT</td><td style="text-align:left;">严重</td></tr><tr><td style="text-align:center;">ngx.ERR</td><td style="text-align:left;">错误</td></tr><tr><td style="text-align:center;">ngx.WARN</td><td style="text-align:left;">警告</td></tr><tr><td style="text-align:center;">ngx.ALERT</td><td style="text-align:left;">报警</td></tr><tr><td style="text-align:center;">ngx.NOTICE</td><td style="text-align:left;">提醒</td></tr><tr><td style="text-align:center;">ngx.STDERR</td><td style="text-align:left;">标准错误</td></tr><tr><td style="text-align:center;">ngx.INFO</td><td style="text-align:left;">信息</td></tr><tr><td style="text-align:center;">ngx.DEBUG</td><td style="text-align:left;">调试</td></tr></tbody></table><p>这次需要修改<code>/usr/local/openresty/nginx/conf/nginx.conf</code>文件。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; vi /usr/local/openresty/nginx/conf/nginx.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 测试四个日志级别，指定日志输出目的地</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error_log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  logs/error.log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error_log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  logs/error.log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  warn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error_log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  logs/error.log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  notice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error_log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  logs/error.log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">......</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    listen</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       9527</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    server_name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  localhost</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        default_type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;text/html&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        lua_code_cache</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        content_by_lua_block</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;string&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">14</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            # 所有的日志内容都会输出到logs/error.log中</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.log(ngx.ERR,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;a ==&gt; &quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.log(ngx.WARN,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;b ==&gt; &quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            # print等价于ngx.log(ngx.NOTICE, ...)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">            print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[[this</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> print]]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.log(ngx.NOTICE,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;c ==&gt; &quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx.log(ngx.INFO,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;d ==&gt; &quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   /usr/local/openresty/nginx/html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        index</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  index.html</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> index.htm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        add_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Cache-Control</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;public&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        add_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Access-Control-Allow-Origin</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    error_page</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   500</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 502</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 503</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 504</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  /50x.html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /50x.html</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">......</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在浏览器中访问<a href="http://xn--IP-fr5c86lx7z:9527/log" target="_blank" rel="noopener noreferrer">http://服务器IP:9527/log</a>，然后到<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>的日志文件中查看输出的日志记录。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cat /usr/local/openresty/nginx/logs/error.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/06/04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 19:47:26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [error] 55838#55838: *54 [lua] content_by_lua(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx.conf:49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):6: a ==&gt; 1, client: 127.0.0.1, server: localhost, request: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET /log HTTP/1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, host: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/06/04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 19:47:26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [error] 55838#55838: *54 [lua] content_by_lua(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx.conf:49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):6: a ==&gt; 1, client: 127.0.0.1, server: localhost, request: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET /log HTTP/1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, host: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/06/04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 19:47:26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [error] 55838#55838: *54 [lua] content_by_lua(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx.conf:49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):6: a ==&gt; 1, client: 127.0.0.1, server: localhost, request: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET /log HTTP/1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, host: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/06/04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 19:47:26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [error] 55838#55838: *54 [lua] content_by_lua(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx.conf:49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):6: a ==&gt; 1, client: 127.0.0.1, server: localhost, request: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET /log HTTP/1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, host: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/06/04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 19:47:26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [warn] 55838#55838: *54 [lua] content_by_lua(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx.conf:49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):7: b ==&gt; string, client: 127.0.0.1, server: localhost, request: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET /log HTTP/1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, host: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/06/04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 19:47:26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [warn] 55838#55838: *54 [lua] content_by_lua(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx.conf:49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):7: b ==&gt; string, client: 127.0.0.1, server: localhost, request: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET /log HTTP/1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, host: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/06/04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 19:47:26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [warn] 55838#55838: *54 [lua] content_by_lua(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx.conf:49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):7: b ==&gt; string, client: 127.0.0.1, server: localhost, request: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET /log HTTP/1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, host: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/06/04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 19:47:26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [notice] 55838#55838: *54 [lua] content_by_lua(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx.conf:49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):8: this is print, client: 127.0.0.1, server: localhost, request: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET /log HTTP/1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, host: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/06/04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 19:47:26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [notice] 55838#55838: *54 [lua] content_by_lua(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx.conf:49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):8: this is print, client: 127.0.0.1, server: localhost, request: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET /log HTTP/1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, host: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/06/04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 19:47:26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [notice] 55838#55838: *54 [lua] content_by_lua(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx.conf:49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):9: c ==&gt; nil, client: 127.0.0.1, server: localhost, request: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET /log HTTP/1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, host: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/06/04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 19:47:26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [notice] 55838#55838: *54 [lua] content_by_lua(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx.conf:49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):9: c ==&gt; nil, client: 127.0.0.1, server: localhost, request: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET /log HTTP/1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, host: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/06/04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 19:47:26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [info] 55838#55838: *54 [lua] content_by_lua(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx.conf:49</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):10: d ==&gt; 3.14, client: 127.0.0.1, server: localhost, request: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;GET /log HTTP/1.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, host: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更多有关<code>ngx</code>的信息可以看这几个地方。</p><ul><li><p>核心常量：<a href="https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/#core-constants" target="_blank" rel="noopener noreferrer">https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/#core-constants</a>。</p></li><li><p>内置变量：<a href="https://nginx.org/en/docs/varindex.html" target="_blank" rel="noopener noreferrer">https://nginx.org/en/docs/varindex.html</a>。</p></li><li><p>日志级别：<a href="https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/#nginx-log-level-constants" target="_blank" rel="noopener noreferrer">https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/#nginx-log-level-constants</a>。</p></li><li><p>HTTP方法：<a href="https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/#http-method-constants" target="_blank" rel="noopener noreferrer">https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/#http-method-constants</a>。</p></li><li><p>HTTP状态码：<a href="https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/#http-status-constants" target="_blank" rel="noopener noreferrer">https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/#http-status-constants</a>。</p></li></ul>`,35);function v(E,b){const a=k("RouteLink");return p(),e("div",null,[d,s("ul",null,[s("li",null,[s("p",null,[g,i("：直接在"),F,i("文件中引入"),A,i("的内容，例如前面的"),n(a,{to:"/technology/programming/lua/#%E5%B0%8F%E6%A0%97%E5%AD%90"},{default:l(()=>[i("小栗子")]),_:1}),i("采取的就是这种方式。")])]),s("li",null,[s("p",null,[y,i("：和前一种一样，只不过将代码组织为代码块，可读性更强一些，前面的"),n(a,{to:"/technology/programming/lua/#%E5%B0%8F%E6%A0%97%E5%AD%90"},{default:l(()=>[i("小栗子")]),_:1}),i("也有这种示范。")])]),s("li",null,[s("p",null,[o,i("：将"),c,i("脚本放到独立的外部文件中，"),u,i("只需引用文件即可，前面的"),n(a,{to:"/technology/programming/lua/#%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87"},{default:l(()=>[i("代码组织")]),_:1}),i("使用的就是这种方式。")])])]),B])}const m=h(r,[["render",v],["__file","api.html.vue"]]),x=JSON.parse('{"path":"/technology/programming/lua/api.html","title":"Nginx Lua API","lang":"zh-CN","frontmatter":{"title":"Nginx Lua API","icon":"scroll","category":["编程语言","LUA"],"tag":["编程语言","LUA"],"date":"2023-02-23T00:00:00.000Z","isOriginal":true,"star":true,"description":"说明 注意 后续所有提到Nginx的地方，指的都是OpenResty中的Nginx，而不是原生的Nginx。 完整的API指令可以参考这两个地方。 API：https://github.com/openresty/lua-nginx-module?tab=readme-ov-file#nginx-api-for-lua。 API：https://ope...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/technology/programming/lua/api.html"}],["meta",{"property":"og:site_name","content":"添码座"}],["meta",{"property":"og:title","content":"Nginx Lua API"}],["meta",{"property":"og:description","content":"说明 注意 后续所有提到Nginx的地方，指的都是OpenResty中的Nginx，而不是原生的Nginx。 完整的API指令可以参考这两个地方。 API：https://github.com/openresty/lua-nginx-module?tab=readme-ov-file#nginx-api-for-lua。 API：https://ope..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"添码座"}],["meta",{"property":"article:tag","content":"编程语言"}],["meta",{"property":"article:tag","content":"LUA"}],["meta",{"property":"article:published_time","content":"2023-02-23T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Nginx Lua API\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-02-23T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"添码座\\",\\"url\\":\\"https://www.tianmazuo.com/about/\\"}]}"]]},"headers":[{"level":2,"title":"说明","slug":"说明","link":"#说明","children":[]},{"level":2,"title":"请求处理","slug":"请求处理","link":"#请求处理","children":[]},{"level":2,"title":"重定向与数据共享","slug":"重定向与数据共享","link":"#重定向与数据共享","children":[]},{"level":2,"title":"日志","slug":"日志","link":"#日志","children":[]}],"git":{},"readingTime":{"minutes":7.69,"words":2306},"filePathRelative":"technology/programming/lua/api.md","localizedDate":"2023年2月23日","excerpt":"<h2>说明</h2>\\n<div class=\\"hint-container warning\\">\\n<p class=\\"hint-container-title\\">注意</p>\\n<p>后续所有提到<a href=\\"https://www.nginx.org/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Nginx</a>的地方，指的都是<a href=\\"https://openresty.org/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">OpenResty</a>中的<a href=\\"https://www.nginx.org/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Nginx</a>，而不是原生的<a href=\\"https://www.nginx.org/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Nginx</a>。</p>\\n<p>完整的<code>API</code>指令可以参考这两个地方。</p>\\n<ul>\\n<li>\\n<p>API：<a href=\\"https://github.com/openresty/lua-nginx-module?tab=readme-ov-file#nginx-api-for-lua\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://github.com/openresty/lua-nginx-module?tab=readme-ov-file#nginx-api-for-lua</a>。</p>\\n</li>\\n<li>\\n<p>API：<a href=\\"https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/</a>。</p>\\n</li>\\n</ul>\\n</div>","autoDesc":true}');export{m as comp,x as data};
