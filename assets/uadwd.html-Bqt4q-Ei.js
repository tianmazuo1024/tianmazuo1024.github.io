import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,o as n,d as a}from"./app-B5m7CcSj.js";const l={},e=a(`<h2 id="构建dwd层" tabindex="-1"><a class="header-anchor" href="#构建dwd层"><span>构建DWD层</span></a></h2><p>参照<code>ODS</code>层的经验，以脚本的方式执行<code>DWD</code>层数据库和表的初始化。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; mkdir -p /home/work/warehouse_user_action</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cd /home/work/warehouse_user_action</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; vi dwd_shopmall_init.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># dwd层数据库和表初始化脚本，只需执行一次</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hive</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">create database if not exists dwd_shopmall;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">create external table if not exists dwd_shopmall.dwd_app_open (</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    uid         bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    did         string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    platform    tinyint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    ver         string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    code        string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    net         tinyint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    brand       string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    model       string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    display     string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    os          string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    timestamp   bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    adstatus    tinyint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    loadingtime bigint</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) partitioned by(dt string)</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  row format delimited</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  fields terminated by &#39;\\t&#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  location &#39;hdfs://server01:9000/data/dwd/app_open/&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">create external table if not exists dwd_shopmall.dwd_goods_click (</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    uid         bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    did         string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    platform    tinyint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    ver         string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    code        string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    net         tinyint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    brand       string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    model       string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    display     string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    os          string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    timestamp   bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    goodsid     bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    location    tinyint</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) partitioned by(dt string)</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  row format delimited</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  fields terminated by &#39;\\t&#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  location &#39;hdfs://server01:9000/data/dwd/goods_click/&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">create external table if not exists dwd_shopmall.dwd_goods_item (</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    uid         bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    did         string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    platform    tinyint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    ver         string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    code        string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    net         tinyint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    brand       string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    model       string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    display     string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    os          string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    timestamp   bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    goodsid     bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    staytime    bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    loadingtime bigint</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) partitioned by(dt string)</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  row format delimited</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  fields terminated by &#39;\\t&#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  location &#39;hdfs://server01:9000/data/dwd/goods_item/&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">create external table if not exists dwd_shopmall.dwd_goods_list (</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    uid         bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    did         string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    platform    tinyint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    ver         string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    code        string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    net         tinyint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    brand       string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    model       string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    display     string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    os          string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    timestamp   bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    loadingtime bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    loadingtype tinyint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    goodsnum    tinyint</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) partitioned by(dt string)</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  row format delimited</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  fields terminated by &#39;\\t&#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  location &#39;hdfs://server01:9000/data/dwd/goods_list/&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">create external table if not exists dwd_shopmall.dwd_app_collapse (</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    uid         bigint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    did         string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    platform    tinyint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    ver         string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    code        string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    net         tinyint,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    brand       string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    model       string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    display     string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    os          string,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    timestamp   bigint</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) partitioned by(dt string)</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  row format delimited</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  fields terminated by &#39;\\t&#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  location &#39;hdfs://server01:9000/data/dwd/app_collapse/&#39;;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h2 id="dwd层抽取" tabindex="-1"><a class="header-anchor" href="#dwd层抽取"><span>DWD层抽取</span></a></h2><p>有了基础数据表之后，就需要让它抽取<code>ODS层</code>的数据来填充自己的表了，依然通过脚本进行。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; mkdir -p /home/work/warehouse_user_action</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cd /home/work/warehouse_user_action</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; vi dwd_shopmall_add_partition.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 基于ods层的表进行清洗，清洗之后的数据会被添加到dwd层对应表的对应分区，每天凌晨执行一次</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;d</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">$1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dt</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +%Y%m%d </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">--date=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1 days ago&quot;\`</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dt</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">$1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hive</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">insert overwrite table dwd_shopmall.dwd_app_open partition(dt = &#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dt</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;) select</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.uid&#39;) as id, # 这里改成id是为了和业务数据表t_user中的id对应</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.did&#39;) as did,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.platform&#39;) as platform,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.ver&#39;) as ver,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.code&#39;) as code,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.net&#39;) as net,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.brand&#39;) as brand,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.model&#39;) as model,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.display&#39;) as display,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.os&#39;) as os,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.timestamp&#39;) as timestamp,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.adstatus&#39;) as adstatus,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.loadingtime&#39;) as loadingtime</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">from </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">select log from ods_shopmall.ods_app_open where dt = &#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dt</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; group by log</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) as tmp</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">where get_json_object(log,&#39;$.did&#39;) != &#39;&#39;; # 过滤出所有APP端的日志</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">insert overwrite table dwd_shopmall.dwd_goods_click partition(dt = &#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dt</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;) select </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.uid&#39;) as id,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.did&#39;) as did,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.platform&#39;) as platform,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.ver&#39;) as ver,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.code&#39;) as code,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.net&#39;) as net,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.brand&#39;) as brand,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.model&#39;) as model,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.display&#39;) as display,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.os&#39;) as os,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.timestamp&#39;) as timestamp,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.goodsid&#39;) as goodsid,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.location&#39;) as location</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">from</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">select log from ods_shopmall.ods_goods_click where dt = &#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dt</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; group by log</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) as tmp</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">where get_json_object(log,&#39;$.did&#39;) != &#39;&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">insert overwrite table dwd_shopmall.dwd_goods_item partition(dt = &#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dt</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;) select </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.uid&#39;) as id,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.did&#39;) as did,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.platform&#39;) as platform,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.ver&#39;) as ver,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.code&#39;) as code,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.net&#39;) as net,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.brand&#39;) as brand,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.model&#39;) as model,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.display&#39;) as display,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.os&#39;) as os,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.timestamp&#39;) as timestamp,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.goodsid&#39;) as goodsid,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.staytime&#39;) as staytime,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.loadingtime&#39;) as loadingtime</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">from</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">select log from ods_shopmall.ods_goods_item where dt = &#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dt</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; group by log</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) as tmp</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">where get_json_object(log,&#39;$.did&#39;) != &#39;&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">insert overwrite table dwd_shopmall.dwd_goods_list partition(dt = &#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dt</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;) select </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.uid&#39;) as id,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.did&#39;) as did,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.platform&#39;) as platform,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.ver&#39;) as ver,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.code&#39;) as code,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.net&#39;) as net,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.brand&#39;) as brand,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.model&#39;) as model,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.display&#39;) as display,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.os&#39;) as os,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.timestamp&#39;) as timestamp,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.loadingtime&#39;) as loadingtime,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.loadingtype&#39;) as loadingtype,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.goodsnum&#39;) as goodsnum</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">from</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">select log from ods_shopmall.ods_goods_list where dt = &#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dt</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; group by log</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) as tmp</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">where get_json_object(log,&#39;$.did&#39;) != &#39;&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">insert overwrite table dwd_shopmall.dwd_app_collapse partition(dt = &#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dt</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;) select </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.uid&#39;) as id,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.did&#39;) as did,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.platform&#39;) as platform,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.ver&#39;) as ver,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.code&#39;) as code,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.net&#39;) as net,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.brand&#39;) as brand,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.model&#39;) as model,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.display&#39;) as display,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.os&#39;) as os,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get_json_object(log,&#39;$.timestamp&#39;) as timestamp</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">from</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">select log from ods_shopmall.ods_app_collapse where dt = &#39;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dt</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; group by log</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) as tmp</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">where get_json_object(log,&#39;$.did&#39;) != &#39;&#39;;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以通过定时任务来执行它。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; crontab -e</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 每天凌晨0点1分执行</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /home/work/warehouse_user_action/dwd_shopmall_add_partition.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以先指定日期执行，测试一下效果。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cd /home/work/warehouse_user_action</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; sh dwd_shopmall_init.sh</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; sh dwd_shopmall_add_partition.sh 20240520</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 进入hive确认结果</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cd /home/work/hive-3.1.3</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; ./bin/hive</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hive</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">use</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dwd_shopmall</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hive</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">show</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tables</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">+-------------------+</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|      </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tab_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">+-------------------+</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">| </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dwd_app_open</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">| </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dwd_goods_click</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">| </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dwd_goods_item</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">| </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dwd_goods_list</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">| </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dwd_app_collapse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">+-------------------+</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> row</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> selected</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (1.702 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">seconds</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">......</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11),t=[e];function p(d,h){return n(),i("div",null,t)}const c=s(l,[["render",p],["__file","uadwd.html.vue"]]),g=JSON.parse(`{"path":"/application/case/warehouse/uadwd.html","title":"用户行为数仓DWD层","lang":"zh-CN","frontmatter":{"title":"用户行为数仓DWD层","icon":"user-tag","category":["案例","数据仓库"],"tag":["案例","数据仓库","用户行为","DWD层"],"date":"2024-05-20T00:00:00.000Z","isOriginal":true,"star":true,"description":"构建DWD层 参照ODS层的经验，以脚本的方式执行DWD层数据库和表的初始化。 DWD层抽取 有了基础数据表之后，就需要让它抽取ODS层的数据来填充自己的表了，依然通过脚本进行。 可以通过定时任务来执行它。 可以先指定日期执行，测试一下效果。","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/application/case/warehouse/uadwd.html"}],["meta",{"property":"og:site_name","content":"添码座"}],["meta",{"property":"og:title","content":"用户行为数仓DWD层"}],["meta",{"property":"og:description","content":"构建DWD层 参照ODS层的经验，以脚本的方式执行DWD层数据库和表的初始化。 DWD层抽取 有了基础数据表之后，就需要让它抽取ODS层的数据来填充自己的表了，依然通过脚本进行。 可以通过定时任务来执行它。 可以先指定日期执行，测试一下效果。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"添码座"}],["meta",{"property":"article:tag","content":"案例"}],["meta",{"property":"article:tag","content":"数据仓库"}],["meta",{"property":"article:tag","content":"用户行为"}],["meta",{"property":"article:tag","content":"DWD层"}],["meta",{"property":"article:published_time","content":"2024-05-20T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"用户行为数仓DWD层\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-05-20T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"添码座\\",\\"url\\":\\"https://www.tianmazuo.com/about/\\"}]}"]]},"headers":[{"level":2,"title":"构建DWD层","slug":"构建dwd层","link":"#构建dwd层","children":[]},{"level":2,"title":"DWD层抽取","slug":"dwd层抽取","link":"#dwd层抽取","children":[]}],"git":{},"readingTime":{"minutes":3.39,"words":1016},"filePathRelative":"application/case/warehouse/uadwd.md","localizedDate":"2024年5月20日","excerpt":"<h2>构建DWD层</h2>\\n<p>参照<code>ODS</code>层的经验，以脚本的方式执行<code>DWD</code>层数据库和表的初始化。</p>\\n<div class=\\"language-shell line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"shell\\" data-title=\\"shell\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">&gt; mkdir -p /home/work/warehouse_user_action</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">&gt; cd /home/work/warehouse_user_action</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">&gt; vi dwd_shopmall_init.sh</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic\\">#!/bin/bash</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic\\"># dwd层数据库和表初始化脚本，只需执行一次</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">hive</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -e</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> \\"</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">create database if not exists dwd_shopmall;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">create external table if not exists dwd_shopmall.dwd_app_open (</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    uid         bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    did         string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    platform    tinyint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    ver         string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    code        string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    net         tinyint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    brand       string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    model       string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    display     string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    os          string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    timestamp   bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    adstatus    tinyint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    loadingtime bigint</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">) partitioned by(dt string)</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  row format delimited</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  fields terminated by '\\\\t'</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  location 'hdfs://server01:9000/data/dwd/app_open/';</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">create external table if not exists dwd_shopmall.dwd_goods_click (</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    uid         bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    did         string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    platform    tinyint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    ver         string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    code        string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    net         tinyint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    brand       string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    model       string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    display     string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    os          string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    timestamp   bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    goodsid     bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    location    tinyint</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">) partitioned by(dt string)</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  row format delimited</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  fields terminated by '\\\\t'</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  location 'hdfs://server01:9000/data/dwd/goods_click/';</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">create external table if not exists dwd_shopmall.dwd_goods_item (</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    uid         bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    did         string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    platform    tinyint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    ver         string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    code        string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    net         tinyint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    brand       string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    model       string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    display     string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    os          string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    timestamp   bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    goodsid     bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    staytime    bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    loadingtime bigint</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">) partitioned by(dt string)</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  row format delimited</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  fields terminated by '\\\\t'</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  location 'hdfs://server01:9000/data/dwd/goods_item/';</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">create external table if not exists dwd_shopmall.dwd_goods_list (</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    uid         bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    did         string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    platform    tinyint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    ver         string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    code        string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    net         tinyint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    brand       string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    model       string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    display     string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    os          string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    timestamp   bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    loadingtime bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    loadingtype tinyint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    goodsnum    tinyint</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">) partitioned by(dt string)</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  row format delimited</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  fields terminated by '\\\\t'</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  location 'hdfs://server01:9000/data/dwd/goods_list/';</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">create external table if not exists dwd_shopmall.dwd_app_collapse (</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    uid         bigint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    did         string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    platform    tinyint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    ver         string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    code        string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    net         tinyint,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    brand       string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    model       string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    display     string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    os          string,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    timestamp   bigint</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">) partitioned by(dt string)</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  row format delimited</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  fields terminated by '\\\\t'</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  location 'hdfs://server01:9000/data/dwd/app_collapse/';</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">\\"</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}`);export{c as comp,g as data};
