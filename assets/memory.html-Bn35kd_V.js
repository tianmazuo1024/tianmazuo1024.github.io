import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,o as a,d as n}from"./app-B5m7CcSj.js";const h={},l=n(`<h2 id="基本思想" tabindex="-1"><a class="header-anchor" href="#基本思想"><span>基本思想</span></a></h2><p>将<a href="https://www.mongodb.com/" target="_blank" rel="noopener noreferrer">MongoDB</a>用作内存数据库（in-memory database），也就是让<code>MongoDB</code>完全在内存中操作者数据的用法，比较适用于以下场景。</p><ul><li><p>置于慢速RDBMS系统之前的写操作密集型高速缓存。</p></li><li><p>嵌入式系统。</p></li><li><p>无需持久化数据的PCI兼容系统。</p></li></ul><p><code>MongoDB</code>可以使用<code>内存影射文件（memory-mapped file）</code>来处理对磁盘文件中数据的读写请求。这也就是说，<code>MongoDB</code>并不对RAM和磁盘这两者进行区别对待，只是将文件看作一个巨大的数组，然后按照字节为单位访问其中的数据，剩下的都交由操作系统去处理。</p><br><h2 id="实现方法" tabindex="-1"><a class="header-anchor" href="#实现方法"><span>实现方法</span></a></h2><p>这是通过使用<code>tmpfs</code>的特殊类型的文件系统实现的。在Linux中它看上去同常规的文件系统一样，只是它完全位于RAM中。例如，在32GB的RAM种创建一个16GB的<code>tmpfs</code>。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; mkdir /ramdata</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; mount -t tmpfs -o </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">16000M</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> tmpfs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /ramdata/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; df</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Filesystem</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           1K-blocks</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      Used</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Available</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Use%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Mounted</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/dev/xvde1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">             5905712</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   4973924</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    871792</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  86%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">none</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                  15344936</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  15344936</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   0%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /dev/shm</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tmpfs</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                 16384000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  16384000</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   0%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /ramdata</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来要用适当的设置启动<code>MongoDB</code>。</p><p>为了减小浪费，应该把<code>smallfiles</code>和<code>noprealloc</code>设置为true。</p><p>既然现在是基于RAM的，这么做完全不会降低性能。此时再使用<code>journal</code>就毫无意义了，所以应该把<code>nojournal</code>设置为<code>true</code>。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dbpath</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/ramdata</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nojournal</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">smallFiles</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">noprealloc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>MongoDB</code>启动后，文件系统中的文件也正如期待的那样出现了。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; mongo</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MongoDB</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> shell</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2.3.2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">connecting</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; db.test.insert({a:1})</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">db.test.find</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{ </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;_id&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ObjectId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;51802115eafa5d80b5d2c145&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;a&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; ls -l /ramdata/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">total</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 65684</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 16777216</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15:52</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> local.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 16777216</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15:52</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> local.ns</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rwxr-xr-x.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15:52</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mongod.lock</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 16777216</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15:52</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 16777216</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15:52</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.ns</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       40</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15:52</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> _tmp</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在可以添加一些数据，证实一下它运行正常。</p><p>先创建一个1KB的document，然后将它添加到MongoDB中4百万次。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; str = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; aaa = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;aaaaaaaaaa&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">aaaaaaaaaa</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">var</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">++i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) { </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">str</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aaa</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">var</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4000000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">++i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) { </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">db.foo.insert(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">{a:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Math.random</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> s:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> str}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">db.foo.stats</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;ns&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;test.foo&quot;,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;count&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 4000000,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;size&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 4544000160,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;avgObjSize&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1136.00004,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;storageSize&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5030768544,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;numExtents&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 26,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;nindexes&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;lastExtentSize&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 536600560,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;paddingFactor&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;systemFlags&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;userFlags&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;totalIndexSize&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 129794000,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;indexSizes&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                &quot;_id_&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 129794000</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;ok&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出，其中的<code>document</code>平均大小为1136字节，数据总共占用了5GB的空间。_id之上的索引大小为130MB。</p><p>现在只需要验证RAM中的数据有没有重复，是不是在<code>MongoDB</code>和文件系统中各保存了一份就行了。</p><p><code>MongoDB</code>并不会在自己的进程内缓存任何数据，数据只会缓存到文件系统的缓存之中。所以清除文件系统的缓存，然后看看RAM中还有什么数据。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># echo 3 &gt; /proc/sys/vm/drop_caches </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># free</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">             total</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       used</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       free</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     shared</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    buffers</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     cached</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Mem:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      30689876</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    6292780</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   24397096</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       1044</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    5817368</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-/+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> buffers/cache:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     474368</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   30215508</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Swap:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，在已使用的6.3GB的RAM中，有5.8GB用于了文件系统的缓存（缓冲区，buffer)。这是因为Linux不会在<code>tmpfs</code>和缓存中保存重复的数据。这也意味着在RAM只有一份数据。</p><p>下面访问一下所有的document，并验证RAM的使用情况不会发生变化。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">db.foo.find</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">.itcount</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">4000000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; free</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">             total</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       used</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       free</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     shared</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    buffers</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     cached</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Mem:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      30689876</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    6327988</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   24361888</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       1324</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    5818012</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-/+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> buffers/cache:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     508652</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   30181224</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Swap:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">          0</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># ls -l /ramdata/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">total</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5808780</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  16777216</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15:52</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> local.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  16777216</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15:52</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> local.ns</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rwxr-xr-x.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15:52</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mongod.lock</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  16777216</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:00</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  33554432</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:00</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 536608768</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:02</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.10</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 536608768</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:03</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.11</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 536608768</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:03</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.12</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 536608768</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.13</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 536608768</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.14</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  67108864</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:00</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 134217728</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:00</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.3</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 268435456</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:00</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 536608768</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:01</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.5</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 536608768</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:01</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.6</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 536608768</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.7</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 536608768</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:03</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.8</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 536608768</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:02</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.9</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-------.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  16777216</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15:52</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test.ns</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        40</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16:04</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> _tmp</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># df</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Filesystem</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           1K-blocks</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      Used</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Available</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Use%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Mounted</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/dev/xvde1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">             5905712</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   4973960</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    871756</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  86%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">none</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                  15344936</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  15344936</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   0%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /dev/shm</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tmpfs</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                 16384000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   5808780</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  10575220</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  36%</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /ramdata</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h2 id="复制-replication-和分片-sharding" tabindex="-1"><a class="header-anchor" href="#复制-replication-和分片-sharding"><span>复制（replication）和分片（sharding）</span></a></h2><p>既然服务器在重启时RAM中的数据都会丢失，所以可能会想使用复制来保存数据。</p><p>采用标准的副本集（replica set）就能够获得自动故障转移（failover），还能够提高数据读取能力（read capacity）。</p><p>如果有服务器重启了，它就可以从同一个副本集中另外一个服务器读取数据从而重建自己的数据（重新同步，resync）。即使在大量数据和索引的情况下，这个过程也不会慢，因为索引操作都是在RAM中进行的。</p><p>对于分片也是一样的。</p><p>不过，需要注意的是，<code>RAM</code>属于稀缺资源，尽管<code>tmpfs</code>具有借助于磁盘交换（swapping）的能力，但其性能下降将非常显著。</p><p>所以，为了充分利用RAM，需要考虑下面几件事。</p><ul><li><p>使用<code>usePowerOf2Sizes</code>选项对存储<code>bucket</code>进行规范化。</p></li><li><p>定期运行compact命令或者对节点进行重新同步（resync）。</p></li><li><p>schema的设计要规范化，避免出现大量比较大的<code>document</code>。</p></li></ul>`,33),k=[l];function t(p,e){return a(),i("div",null,k)}const g=s(h,[["render",t],["__file","memory.html.vue"]]),A=JSON.parse('{"path":"/technology/middleware/mongodb/memory.html","title":"作为纯内存数据库使用","lang":"zh-CN","frontmatter":{"title":"作为纯内存数据库使用","icon":"lemon","category":["中间件","MongoDB"],"tag":["中间件","MongoDB","内存数据库"],"date":"2023-01-19T00:00:00.000Z","isOriginal":true,"star":true,"description":"基本思想 将MongoDB用作内存数据库（in-memory database），也就是让MongoDB完全在内存中操作者数据的用法，比较适用于以下场景。 置于慢速RDBMS系统之前的写操作密集型高速缓存。 嵌入式系统。 无需持久化数据的PCI兼容系统。 MongoDB可以使用内存影射文件（memory-mapped file）来处理对磁盘文件中数据的...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/technology/middleware/mongodb/memory.html"}],["meta",{"property":"og:site_name","content":"添码座"}],["meta",{"property":"og:title","content":"作为纯内存数据库使用"}],["meta",{"property":"og:description","content":"基本思想 将MongoDB用作内存数据库（in-memory database），也就是让MongoDB完全在内存中操作者数据的用法，比较适用于以下场景。 置于慢速RDBMS系统之前的写操作密集型高速缓存。 嵌入式系统。 无需持久化数据的PCI兼容系统。 MongoDB可以使用内存影射文件（memory-mapped file）来处理对磁盘文件中数据的..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"添码座"}],["meta",{"property":"article:tag","content":"中间件"}],["meta",{"property":"article:tag","content":"MongoDB"}],["meta",{"property":"article:tag","content":"内存数据库"}],["meta",{"property":"article:published_time","content":"2023-01-19T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"作为纯内存数据库使用\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-01-19T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"添码座\\",\\"url\\":\\"https://www.tianmazuo.com/about/\\"}]}"]]},"headers":[{"level":2,"title":"基本思想","slug":"基本思想","link":"#基本思想","children":[]},{"level":2,"title":"实现方法","slug":"实现方法","link":"#实现方法","children":[]},{"level":2,"title":"复制（replication）和分片（sharding）","slug":"复制-replication-和分片-sharding","link":"#复制-replication-和分片-sharding","children":[]}],"git":{},"readingTime":{"minutes":4.7,"words":1410},"filePathRelative":"technology/middleware/mongodb/memory.md","localizedDate":"2023年1月19日","excerpt":"<h2>基本思想</h2>\\n<p>将<a href=\\"https://www.mongodb.com/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">MongoDB</a>用作内存数据库（in-memory database），也就是让<code>MongoDB</code>完全在内存中操作者数据的用法，比较适用于以下场景。</p>\\n<ul>\\n<li>\\n<p>置于慢速RDBMS系统之前的写操作密集型高速缓存。</p>\\n</li>\\n<li>\\n<p>嵌入式系统。</p>\\n</li>\\n<li>\\n<p>无需持久化数据的PCI兼容系统。</p>\\n</li>\\n</ul>","autoDesc":true}');export{g as comp,A as data};
