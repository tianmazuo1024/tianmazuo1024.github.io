import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as n,c as h,a as i,e as s,b as l,w as k,d as a,o as r}from"./app-B5m7CcSj.js";const p={},d=a(`<h2 id="单机事务" tabindex="-1"><a class="header-anchor" href="#单机事务"><span>单机事务</span></a></h2><p>所谓<code>单机事务</code>指的就是<a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1" target="_blank" rel="noopener noreferrer">事务</a>，它具有<code>原子性（Atomicity）</code>、<code>一致性（Consistency）</code>、<code>隔离性（Isolation）</code>和<code>持久性（Durability/Permanence）</code>。</p><p>执行<a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1" target="_blank" rel="noopener noreferrer">事务</a>的时候，一般以<code>BEGIN</code>开头，以<code>END</code>结尾，中间要么<code>COMMIT TRANSACTION</code>，要么<code>ROLLBACK TRANSACTION</code>。</p><p>下面是实现<a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1" target="_blank" rel="noopener noreferrer">事务</a>的<code>SQL</code>伪代码。</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> START TRANSACTION</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 汇总错误次数</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DECLARE</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @errorSum</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> t_account </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> money</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> money</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> - </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> username </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;lixingyun&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SET</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @errorSum</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @errorSum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> + @@error;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> t_order(id, productId, userId, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">number</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, price) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21885463287451214</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SET</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @errorSum</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @errorSum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> + @@error;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> t_order_details(id, orderId, ......) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21885463287451214</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ......);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SET</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @errorSum</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @errorSum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> + @@error;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> t_order_details(id, orderId, ......) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">21885463287451214</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ......);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SET</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @errorSum</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @errorSum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> + @@error;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> UPDATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> t_store </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> number</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> number</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> - </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> productId </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SET</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @errorSum</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @errorSum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> + @@error;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 如果有错误就回滚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> IF</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> @errorSum</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> print</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;交易失败，回滚事务&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ROLLBACK</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TRANSACTION</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 否则就提交</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ELSE</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> print</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;交易成功，提交事务&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> COMMIT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TRANSACTION</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> END</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TRANSACTION</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h2 id="分布式事务" tabindex="-1"><a class="header-anchor" href="#分布式事务"><span>分布式事务</span></a></h2><p>在<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F" target="_blank" rel="noopener noreferrer">分布式系统</a>出现以后，也出现了<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1" target="_blank" rel="noopener noreferrer">分布式事务</a>问题，它其实非常像一个本地数据库的<code>放大版</code>，但又有所不同。</p><p>针对<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1" target="_blank" rel="noopener noreferrer">分布式事务</a>主要有两种：<a href="https://zh.wikipedia.org/wiki/CAP%E5%AE%9A%E7%90%86" target="_blank" rel="noopener noreferrer">CAP定理</a>和<a href="https://baike.baidu.com/item/BASE%E7%90%86%E8%AE%BA" target="_blank" rel="noopener noreferrer">BASE理论</a>。</p><h3 id="定理一-cap" tabindex="-1"><a class="header-anchor" href="#定理一-cap"><span>定理一：CAP</span></a></h3><p><a href="https://zh.wikipedia.org/wiki/CAP%E5%AE%9A%E7%90%86" target="_blank" rel="noopener noreferrer">CAP定理</a>又叫<code>布鲁尔定理（Brewer&#39;s theorem）</code>，它是<code>Consistency（一致性）</code>、<code>Availability（可用性）</code>和<code>Partition Tolerance（分区容错度）</code>这三个首字母的缩写。</p><figure><img src="https://tianmazuo.com/technology/distributed/distributed-10.png" alt="CAP定理" tabindex="0" loading="lazy"><figcaption>CAP定理</figcaption></figure><p><a href="https://zh.wikipedia.org/wiki/CAP%E5%AE%9A%E7%90%86" target="_blank" rel="noopener noreferrer">CAP定理</a>有两个非常明确的界定。</p><ul><li><p>一是它认为任何<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F" target="_blank" rel="noopener noreferrer">分布式系统</a>都不可能同时满足<code>Consistency</code>、<code>Availability</code>和<code>Partition Tolerance</code>这三者中的全部。</p></li><li><p>二是<code>C</code>、<code>A</code>和<code>P</code>这三者中，只能首先满足<code>P</code>，然后满足<code>A</code>，至于<code>C</code>，则通过<code>以时间换空间</code>的方式实现，这是因为<code>C</code>是可以被分为三个不同的层次的。</p><ul><li><p><code>强一致性</code>：在任意时刻，所有不同的分布式节点中的数据完全一致，不容许存在任何不一致的情况。这种一致性需要非常强力的保证机制，其结果就是可能会影响到系统运行时的性能与响应速度，不过在金融、证券、医疗、航空航天等关乎国计民生的行业中，这种<code>强一致性</code>是必须的。</p></li><li><p><code>弱一致性</code>：当某个分布式节点中的数据被更新后，后续对该数据的读取操作可能得到更新后的值，也可能是更改前的值。这种弱一致性既没有机制上的保障，也没有时间上的保证，即不知道也不保证多久后数据将被更新为正确的数值。</p></li><li><p><code>最终一致性</code>：分布式系统不保证在任意时刻任意节点上的同一份数据都是相同的，但是随着时间的迁移，不同节点上的同一份数据总是在向趋同的方向变化，即所有数据哪怕当前有错误、遗漏或混乱，但只要在系统不停止运行的前提下，它总能够更新到正确的数值。</p></li></ul></li></ul><p>上面所说的<code>时间换空间</code>的方式就是指的<a href="https://zh.wikipedia.org/wiki/%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7" target="_blank" rel="noopener noreferrer">最终一致性</a>。</p><h3 id="定理二-base" tabindex="-1"><a class="header-anchor" href="#定理二-base"><span>定理二：BASE</span></a></h3><p><a href="https://baike.baidu.com/item/BASE%E7%90%86%E8%AE%BA" target="_blank" rel="noopener noreferrer">BASE定理</a>是<a href="https://zh.wikipedia.org/wiki/CAP%E5%AE%9A%E7%90%86" target="_blank" rel="noopener noreferrer">CAP定理</a>的延续和扩展，它的核心思想简单来说就是：如果无法做到强一致，那么每个应用都可以根据自身的业务特点，采用适当的方式来使系统达到<a href="https://zh.wikipedia.org/wiki/%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7" target="_blank" rel="noopener noreferrer">最终一致性</a>。</p><figure><img src="https://tianmazuo.com/technology/distributed/distributed-11.png" alt="BASE定理" tabindex="0" loading="lazy"><figcaption>BASE定理</figcaption></figure><p>和<a href="https://zh.wikipedia.org/wiki/CAP%E5%AE%9A%E7%90%86" target="_blank" rel="noopener noreferrer">CAP定理</a>一样，<a href="https://baike.baidu.com/item/BASE%E7%90%86%E8%AE%BA" target="_blank" rel="noopener noreferrer">BASE定理</a>也由几个方面界定。</p><ul><li><p><code>BA（Basic Available）基本可用</code>：<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F" target="_blank" rel="noopener noreferrer">分布式系统</a>可以通过适当延长响应时间，或者返回一个性能降级页面，从而缓解服务器压力。例如当举行大促（秒杀）之类的活动时，有些用户访问网站时间变长，或者得到<code>服务繁忙</code>的响应页面，这就是典型的性能降级措施。</p></li><li><p><code>S（Soft State）柔性状态</code>：指允许<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F" target="_blank" rel="noopener noreferrer">分布式系统</a>中的数据存在中间状态，并认为该中间状态的存在不会影响系统整体的稳定性与可用性。即允许系统不同节点之间的数据存在不一致，并允许数据同步的过程存在延时，这其实就是<a href="https://zh.wikipedia.org/wiki/CAP%E5%AE%9A%E7%90%86" target="_blank" rel="noopener noreferrer">CAP定理</a>中的<code>弱一致性</code>层次。</p></li><li><p><code>E（Eventual Consisstency）最终一致性</code>：<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F" target="_blank" rel="noopener noreferrer">分布式系统</a>中同一数据不同副本的状态，可以不必时刻保持一致，但一定要保证在经过一段时间后是一致的，这也是<a href="https://zh.wikipedia.org/wiki/CAP%E5%AE%9A%E7%90%86" target="_blank" rel="noopener noreferrer">CAP定理</a>中的<code>最终一致性</code>。</p></li></ul><p><a href="https://zh.wikipedia.org/wiki/CAP%E5%AE%9A%E7%90%86" target="_blank" rel="noopener noreferrer">CAP定理</a>和<a href="https://baike.baidu.com/item/BASE%E7%90%86%E8%AE%BA" target="_blank" rel="noopener noreferrer">BASE定理</a>本质上就是同一个意思：<code>以时间换空间</code>。</p><figure><img src="https://tianmazuo.com/technology/distributed/distributed-12.png" alt="两种定理的比较" tabindex="0" loading="lazy"><figcaption>两种定理的比较</figcaption></figure><h3 id="_2pc" tabindex="-1"><a class="header-anchor" href="#_2pc"><span>2PC</span></a></h3><p><a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>的全称是<code>Two Phase Commit Protocol</code>，即<code>两阶段提交协议</code>，<code>两阶段</code>指的是<code>准备阶段</code>和<code>提交阶段</code>。</p><p>在<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>中有两种角色：<code>事务协调者</code>和<code>事务参与者</code>。</p><p><code>事务协调者</code>也称为<code>事务管理器TM（Transaction Manager）</code>，通常一个分布式系统中只有一个，而<code>事务参与者</code>也称为<code>资源管理器RM（Resource Manager）</code>，通常一个分布式系统中也只有一个。</p><p><code>准备阶段</code>的执行过程如下图所示。</p><figure><img src="https://tianmazuo.com/technology/distributed/distributed-13.png" alt="2PC中的准备阶段" tabindex="0" loading="lazy"><figcaption>2PC中的准备阶段</figcaption></figure><ul><li><p><code>事务协调者TM</code>给每个<code>事务参与者RM</code>发送<code>Prepare</code>消息，询问是否已准备好。</p></li><li><p>每个<code>事务参与者RM</code>要么直接返回失败（如权限验证失败），要么在本地开始执行事务操作，写本地的<code>redo</code>和<code>undo</code>日志，但不提交事务。</p></li><li><p>如果<code>事务参与者RM</code>操作成功，则给<code>事务协调者TM</code>返回成功，否则返回失败。</p></li></ul><p>而在<code>提交阶段</code>的执行过程如下图所示。</p><figure><img src="https://tianmazuo.com/technology/distributed/distributed-14.png" alt="2PC中的提交阶段" tabindex="0" loading="lazy"><figcaption>2PC中的提交阶段</figcaption></figure><p>整个<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>的事务执行过程类似一场运动比赛，裁判就是<code>事务协调者TM</code>，而运动员们就是<code>事务参与者RM</code>。</p><p><a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>的优势在于：尽可能地保证了数据的强一致性，它非常适合对数据的强一致性要求很高的业务场景。但不足也很明显：性能严重拖后腿、实现复杂，所以不适合具有海量终端用户的高并发、高TPS、大吞吐量的分布式应用。</p><h3 id="_3pc" tabindex="-1"><a class="header-anchor" href="#_3pc"><span>3PC</span></a></h3><p>由于<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>的性能不够理想，于是有了它的改进版本：<a href="https://en.wikipedia.org/wiki/Three-phase_commit_protocol" target="_blank" rel="noopener noreferrer">3PC</a>。</p><p><a href="https://en.wikipedia.org/wiki/Three-phase_commit_protocol" target="_blank" rel="noopener noreferrer">3PC</a>全称<code>Three Phase Commit Protocol</code>，即<code>三阶段提交协议</code>。</p><p>相较于<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>，<a href="https://en.wikipedia.org/wiki/Three-phase_commit_protocol" target="_blank" rel="noopener noreferrer">3PC</a>有两个不同的地方。</p><ul><li><p>为了提升性能，<a href="https://en.wikipedia.org/wiki/Three-phase_commit_protocol" target="_blank" rel="noopener noreferrer">3PC</a>在<code>事务协调者TM</code>和<code>事务参与者RM</code>中都引入了超时机制。</p></li><li><p>为了提升可靠性，它在<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>的准备阶段和提交阶段之间插入了一个预提交阶段，保证在最后提交阶段之前各参与节点的状态是一致的，其实就是再多确认一遍，防止出错。</p></li></ul><figure><img src="https://tianmazuo.com/technology/distributed/distributed-15.png" alt="3PC的工作流程" tabindex="0" loading="lazy"><figcaption>3PC的工作流程</figcaption></figure><p>上面的第<code>1 ~ 3</code>步表示<code>canCommit</code>阶段，第<code>4 ~ 6</code>步表示<code>preCommit</code>阶段，而第<code>7 ~ 9</code>步则代表<code>doCommit</code>阶段。</p><ul><li><p><code>第一阶段（canCommit）</code>：<code>事务协调者TM</code>给所有的<code>事务参与者RM</code>发起<code>canCommit</code>请求，<code>事务参与者RM</code>收到请求后，根据自己的情况判断是否可以执行提交。如果可以则返回<code>OK</code>，否者返回<code>FAIL</code>，且执行时不开启本地事务。</p></li><li><p><code>第二阶段（preCommit）</code>：<code>事务协调者TM</code>向所有<code>事务参与者RM</code>发起<code>preCommit</code>请求，<code>事务参与者RM</code>收到请求后，开启本地事务并执行，但执行完后并不提交事务，这和<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>中的第一阶段是一致的。</p></li><li><p><code>第三阶段（doCommit）</code>：此时与两阶段中的第二阶段一致，向所有<code>事务参与者RM</code>发起提交事务的请求，<code>事务参与者RM</code>收到通知，或者提交事务，或者超时，并将事务提交的结果反馈给<code>事务协调者TM</code>。</p></li></ul><p>相较于<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>，<a href="https://en.wikipedia.org/wiki/Three-phase_commit_protocol" target="_blank" rel="noopener noreferrer">3PC</a>的改进无非就是多了一个确认过程，而且整体的性能提升并不明显，所以同样没能得以普及。</p><p>除了<a href="https://en.wikipedia.org/wiki/Three-phase_commit_protocol" target="_blank" rel="noopener noreferrer">3PC</a>，<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>还衍生出了另外一种也有三个<code>阶段</code>的分布式事务解决方案：<a href="https://seata.apache.org/zh-cn/blog/tcc-mode-design-principle/" target="_blank" rel="noopener noreferrer">TCC</a>。</p><h3 id="tcc" tabindex="-1"><a class="header-anchor" href="#tcc"><span>TCC</span></a></h3><p><a href="https://seata.apache.org/zh-cn/blog/tcc-mode-design-principle/" target="_blank" rel="noopener noreferrer">TCC</a>是一种从<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>发展出来的相对比较成熟的分布式事务解决方案。</p><p>它的全称是<code>Try-Confirm-Cancel</code>，它是由<code>Try</code>、<code>Confirm</code>、<code>Cancel</code>这三个部分组成，并且都要由工程师手动编码实现。</p><p><a href="https://seata.apache.org/zh-cn/blog/tcc-mode-design-principle/" target="_blank" rel="noopener noreferrer">TCC</a>本质上属于一种柔性事务，由于它需要与具体业务耦合，所以侵入性很强。它的一般实现过程如下图所示。</p><figure><img src="https://tianmazuo.com/technology/distributed/distributed-16.png" alt="TCC工作机制" tabindex="0" loading="lazy"><figcaption>TCC工作机制</figcaption></figure><ul><li><p>所有事务参与者都需要实现<code>try</code>，<code>confirm</code>，<code>cancel</code>这三个方法。</p></li><li><p>事务发起方向事务协调者发起事务请求，事务协调者调用所有事务参与者的<code>try</code>方法完成资源的预留。</p></li><li><p>如果事务协调者发现有事务参与者的<code>try</code>方法在预留资源时失败，则调用事务参与者的<code>cancel</code>方法回滚，但<code>cancel</code>方法需要实现业务<code>幂等</code>。</p></li><li><p>如果事务协调者发现所有事务参与者的<code>try</code>方法返回都OK，则事务协调者调用所有参与者的<code>confirm</code>方法。这时不做资源检查，直接提交。</p></li><li><p>如果事务协调者发现所有事务参与者的<code>confirm</code>方法都成功了，则分布式事务结束。</p></li><li><p>如果事务协调者发现有些事务参与者的<code>confirm</code>方法失败了，或者由于网络原因没有收到回执，则会进行重试。</p></li><li><p>如果重试一定次数后还是失败就做事务补偿。</p></li></ul><p><a href="https://seata.apache.org/zh-cn/blog/tcc-mode-design-principle/" target="_blank" rel="noopener noreferrer">TCC</a>的侵入性极强，而且由于<a href="https://seata.apache.org/zh-cn/blog/tcc-mode-design-principle/" target="_blank" rel="noopener noreferrer">TCC</a>的操作本身分为两个阶段，因此所有的业务代码都需要做相应的改造，这一点在选用之前务必要搞清楚。</p><p>另外，由于网络或事务本身的异常可能会导致<code>try</code>、<code>confirm</code>和<code>cancel</code>这三个方法被执行多次，所以它们也必须要实现接口的幂等性。</p><h3 id="本地消息表" tabindex="-1"><a class="header-anchor" href="#本地消息表"><span>本地消息表</span></a></h3><p>由于<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>及其衍生出来的<a href="https://en.wikipedia.org/wiki/Three-phase_commit_protocol" target="_blank" rel="noopener noreferrer">3PC</a>和<a href="https://seata.apache.org/zh-cn/blog/tcc-mode-design-principle/" target="_blank" rel="noopener noreferrer">TCC</a>始终带有强一致性的事务约束，所以后来<a href="https://www.ebay.com/" target="_blank" rel="noopener noreferrer">eBay</a>公司提出了一种和<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>思想完全不同的分布式事务解决方案：<code>本地消息表</code>，其核心思路是将需要分布式处理的任务通过事务消息的方式来异步执行。</p><p>事务消息可以存储到本地文本、<code>SQL</code>、<a href="https://en.wikipedia.org/wiki/NoSQL" target="_blank" rel="noopener noreferrer">NoSQL</a>或<a href="https://zh.wikipedia.org/wiki/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97" target="_blank" rel="noopener noreferrer">消息队列</a>中，然后再通过业务规则自动地或人工地发起重试，直到事务被成功执行，或达到失败上限后回滚。需要注意的是，<code>本地消息表</code>中的<code>本地</code>是相对于分布式环境而言的，它是一个逻辑上的概念，而非绝对物理上的概念。</p><p>此方案在实际实现时，绝大多数都是要么将事务消息保存在<a href="https://zh.wikipedia.org/wiki/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97" target="_blank" rel="noopener noreferrer">消息队列</a>的事务消息队列中，要么将它保存在独立的<a href="https://en.wikipedia.org/wiki/NoSQL" target="_blank" rel="noopener noreferrer">NoSQL</a>中。</p><p>以订单支付系统为例，老式的本地消息表的实现过程如下图所示。</p><figure><img src="https://tianmazuo.com/technology/distributed/distributed-17.png" alt="本地消息表工作机制" tabindex="0" loading="lazy"><figcaption>本地消息表工作机制</figcaption></figure><ul><li><p>作为事务发起方，订单服务在保存订单数据时，也保存一条消息记录到消息表中。</p></li><li><p>订单服务通过消息中间件给支付组件发送订单相关消息。</p></li><li><p>支付组件将收到的消息保存在事务自己的消息表中，同时将支付完毕的订单数据通过消息队列再发送给订单服务。</p></li><li><p>订单服务收到支付组件发来的业务处理消息，同时将之前状态为<code>未支付</code>的消息，改为<code>已支付</code>状态。</p></li></ul><p>但早期的消息表方案有几个明显的问题。</p><ul><li><p>事务发起方和事务被调用方使用不同的消息表，给操作上带来极大不便，而且也会带来性能上的损失，其实完全没有必要分成两部分。</p></li><li><p>有些本地消息表的实现方案要求保存业务数据和保存消息数据必须在同一个本地事务中，这也完全没必要。因为消息有可能会保存在<a href="https://en.wikipedia.org/wiki/NoSQL" target="_blank" rel="noopener noreferrer">NoSQL</a>中，而<a href="https://en.wikipedia.org/wiki/NoSQL" target="_blank" rel="noopener noreferrer">NoSQL</a>是不太可能有事务的。</p></li><li><p>没有对消息投递失败的情况作出处理，这有可能会造成回滚记录缺失或两边的事务消息数据不一致的问题，也就是有订单支付异常记录，但却没有对应的消息可查、可回滚。</p></li></ul><p>有鉴于此，在本地消息表的基础上产生改良方案：<code>可靠消息最终一致性</code>。</p><h3 id="可靠消息最终一致性" tabindex="-1"><a class="header-anchor" href="#可靠消息最终一致性"><span>可靠消息最终一致性</span></a></h3><p>本地消息表方案不同的是，<code>可靠消息最终一致性</code>方案不仅将事务主动方消息表和事务被动方消息表合二为一，也不仅将本地消息表设立为独立消息服务，而且还通过定时读取消息表这种<code>补偿</code>的方式确保了数据的一致性。这是一种基于柔性事务的最终一致性，它允许存在中间状态，但一段时间后，能够达到数据的最终一致性状态即视为事务成功完成。</p><figure><img src="https://tianmazuo.com/technology/distributed/distributed-18.png" alt="可靠消息最终一致性方案" tabindex="0" loading="lazy"><figcaption>可靠消息最终一致性方案</figcaption></figure><ul><li><p>业务逻辑的处理服务在事务提交前，先封装消息。</p></li><li><p>待处理完若干业务后，消息先存储然后再通过MQ发送。</p></li><li><p>消费者收到消息后，就启动相应的任务，并放到定时任务线程池中执行。</p></li><li><p>如果业务操作成功完成，就删除预先保存的消息。</p></li><li><p>如果业务处理状态不明确（失败或超时），那么独立的消息系统会每隔一段指定的时间就把所有存储的消息都重发一遍，直到与消息相关的业务被成功执行为止。</p></li></ul><p>可消息最终一致性的实现关键点在于两点。</p><ul><li><p>事务消息的存储。为实现这个目标，可以采用<a href="https://www.mongodb.com/" target="_blank" rel="noopener noreferrer">MongoDB</a>、<a href="https://www.redis.io/" target="_blank" rel="noopener noreferrer">Redis</a>、<a href="https://cassandra.apache.org/" target="_blank" rel="noopener noreferrer">Cassandra</a>、<a href="https://www.elastic.co/" target="_blank" rel="noopener noreferrer">Elasticsearch</a>等<a href="https://en.wikipedia.org/wiki/NoSQL" target="_blank" rel="noopener noreferrer">NoSQL</a>，然后使用定时任务定期读取所有已保存的且为<code>发送中</code>的消息。</p></li><li><p>消息的可靠投递。不同的消息队列中间件有不同的方式来确保消息的可靠投递。例如，<a href="https://rocketmq.apache.org/" target="_blank" rel="noopener noreferrer">RocketMQ</a>使用事务、半消息、消息持久化、同步双写、重试机制等方式来实现消息投递的可靠性。</p></li></ul><br><h2 id="saga" tabindex="-1"><a class="header-anchor" href="#saga"><span>Saga</span></a></h2><p>虽然<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>及其衍生出来的<a href="https://en.wikipedia.org/wiki/Three-phase_commit_protocol" target="_blank" rel="noopener noreferrer">3PC</a>、<a href="https://seata.apache.org/zh-cn/blog/tcc-mode-design-principle/" target="_blank" rel="noopener noreferrer">TCC</a>、消息表等方式可以保证实现事务的最终一致性，但对于某些分布式事务场景，如流程多、时间长，且还会涉及到调用外部不可控的接口服务时，之前的那些解决方案就有些力不从心了。尤其是体现在以金融为核心业务的应用中，一个流程下来，涉及到的利益相关方可能多达十几个，接口调用更是完全不可控。有鉴于此，1987年普林斯顿大学的<code>Hector Garcia-Molina</code>和<code>Kenneth Salem</code>两人联名共同发表了一篇针对这类<code>长事务（Long Lived Transaction）</code>的论文。</p><p>论文的核心思想是将<code>长事务</code>，也就是分布于多个不同系统中的全部事务视为一个整体，然后再将它们拆分为一个一个的本地<code>短事务</code>，由<code>长事务</code>来统一协调，就好像这些事务是处于一个大的虚拟的逻辑的数据库中一样。</p><p>他们把这种复杂且不可控的<code>长事务</code>命名为<a href="https://seata.apache.org/zh-cn/docs/user/mode/saga/" target="_blank" rel="noopener noreferrer">Saga</a>，并且定义了<a href="https://seata.apache.org/zh-cn/docs/user/mode/saga/" target="_blank" rel="noopener noreferrer">Saga</a>的两个核心属性。</p><ul><li><p>每个<a href="https://seata.apache.org/zh-cn/docs/user/mode/saga/" target="_blank" rel="noopener noreferrer">Saga</a>都由一系列<code>有序</code>的<code>子事务（Sub-Transaction）Ti</code>组成。</p></li><li><p>每个<code>Ti</code>都有对应的补偿动作<code>Ci</code>，补偿作用于撤销Ti所造成的结果。</p></li></ul><p>例如，锁定并扣减库存是T1、创建订单是T2、支付服务是T3，那么针对每个<code>Ti</code>都对应一个补偿动作<code>Ci</code>，即为回复并解锁库存C1、撤销订单C2、返还支付金额C3。</p><p><a href="https://seata.apache.org/zh-cn/docs/user/mode/saga/" target="_blank" rel="noopener noreferrer">Saga</a>有两种恢复策略。</p><ul><li><code>前向恢复（forward recovery）</code>，也叫做<code>勇往直前</code>，就是执行到底，不成功就会一直尝试，这种方式适用于必须要成功的场景。</li></ul><figure><img src="https://tianmazuo.com/technology/distributed/distributed-20.png" alt="Saga前向恢复" tabindex="0" loading="lazy"><figcaption>Saga前向恢复</figcaption></figure><ul><li><code>后向恢复（backward recovery）</code>，也叫做<code>一退到底</code>，在执行事务失败时，补偿所有已完成的事务，而且补偿时是按照Ti执行的倒序进行的。例如，先补偿C3，再C2，最后补偿C1。</li></ul><figure><img src="https://tianmazuo.com/technology/distributed/distributed-21.png" alt="Saga后向恢复" tabindex="0" loading="lazy"><figcaption>Saga后向恢复</figcaption></figure><p>在分布式协调方面，<a href="https://seata.apache.org/zh-cn/docs/user/mode/saga/" target="_blank" rel="noopener noreferrer">Saga</a>也采用了两种模式。</p><ul><li><code>编排（Choreography）方式</code>：通过事件让各个子事务之间互相调用、分配、决策和排序，这是一种去中心化的模式。</li></ul><figure><img src="https://tianmazuo.com/technology/distributed/distributed-22.png" alt="Saga编排方式" tabindex="0" loading="lazy"><figcaption>Saga编排方式</figcaption></figure><ul><li><code>控制（Orchestration）方式</code>：通过中心控制类来统一调用和接受服务的反馈，处理事务的执行和回滚步骤。</li></ul><figure><img src="https://tianmazuo.com/technology/distributed/distributed-23.png" alt="Saga控制方式" tabindex="0" loading="lazy"><figcaption>Saga控制方式</figcaption></figure><p>这两种方式的区别简单来说就是有<a href="https://seata.apache.org/zh-cn/docs/user/mode/saga/" target="_blank" rel="noopener noreferrer">Saga</a>控制器和没有<a href="https://seata.apache.org/zh-cn/docs/user/mode/saga/" target="_blank" rel="noopener noreferrer">Saga</a>控制器的区别。</p><p>作为一种分布式事务解决方案，<a href="https://seata.apache.org/zh-cn/docs/user/mode/saga/" target="_blank" rel="noopener noreferrer">Saga</a>已经成为开源的<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>分布式事务框架所支持的四大事务模式之一。</p><br><h2 id="seata" tabindex="-1"><a class="header-anchor" href="#seata"><span>Seata</span></a></h2><p>除了<a href="https://zh.wikipedia.org/wiki/CAP%E5%AE%9A%E7%90%86" target="_blank" rel="noopener noreferrer">CAP定理</a>和<a href="https://baike.baidu.com/item/BASE%E7%90%86%E8%AE%BA" target="_blank" rel="noopener noreferrer">BASE理论</a>这两大理论性框架，<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1" target="_blank" rel="noopener noreferrer">分布式事务</a>还有若干种解决方案，包括<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>、<a href="https://en.wikipedia.org/wiki/Three-phase_commit_protocol" target="_blank" rel="noopener noreferrer">3PC</a>、<a href="https://seata.apache.org/zh-cn/blog/tcc-mode-design-principle/" target="_blank" rel="noopener noreferrer">TCC</a>、<code>本地消息表</code>、<code>可靠消息最终一致性</code>、<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>等。</p><p>尤其是<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>，它是目前为止<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1" target="_blank" rel="noopener noreferrer">分布式事务</a>中比较完备的一种解决方案，也可以说是集大成者。</p><p><a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>是<code>Simple Extensible Autonomous Transaction Architecture</code>这几个首字母的简写 ，用官网的话来说，它<code>是一款开源的分布式事务解决方案，致力于在微服务架构下提供高性能和简单易用的分布式事务服务</code>，意为<code>简单可扩展的自主事务架构</code>，该项目的目标是<code>让分布式事务的使用像本地事务的使用一样，简单和高效，并逐步解决开发者们遇到的分布式事务方面的所有难题</code>，相当于从互联网的层面重写数据库事务引擎。</p><p><a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>主要由三个部分组成。</p><ul><li><p><code>TC</code>：<code>Transaction Coordinator事务协调器</code>，负责维护全局和分支事务的状态，驱动全局性事务的提交或回滚。</p></li><li><p><code>TM</code>：<code>Transaction Manager事务管理者</code>，它定义全局事务的范围，开始、提交或回滚全局事务。类似于<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>中的事务协调者。</p></li><li><p><code>RM</code>：<code>Resource Manager资源管理者</code>，它用于管理分支事务上的资源，并且向<code>TC</code>注册分支事务，上报分支事务的状态，接收<code>TC</code>的命令来提交或者回滚分支事务，类似于<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>中的事务参与者。</p></li></ul><p>拿订单、支付和库存来举例。在微服务架构下，它们分别代表了三个微服务，通过RPC实现接口调用。</p><figure><img src="https://tianmazuo.com/technology/distributed/distributed-24.png" alt="微服务架构" tabindex="0" loading="lazy"><figcaption>微服务架构</figcaption></figure><p>如果它们的分布式事务交由<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>来完成的话，那么就会是下面这样的。</p><figure><img src="https://tianmazuo.com/technology/distributed/distributed-25.png" alt="Seata控制下的分布式事务" tabindex="0" loading="lazy"><figcaption>Seata控制下的分布式事务</figcaption></figure><ul><li><p>业务调用方作为事务入口，例如，<code>Service</code>层或<code>Controller</code>层。程序代码中会通过<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>的全局事务注解<code>@GlobalTransactional</code>来指明它是一个全局事务，这时它的角色为<code>事务管理者TM</code>并与作为<code>事务协调器TC</code>的<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>交互。然后，<code>事务管理者TM</code>向<code>事务协调器TC</code>发送请求，说明程序即将开启一个全局事务，<code>事务协调器TC</code>生成并返回业务调用方一个全局唯一的事务ID，即<code>XID</code>。业务调用方得到<code>XID</code>后，将它作为参数，开始调用微服务，例如支付服务Payment。</p></li><li><p>当Payment收到<code>XID</code>时就知道自己的事务是全局事务的一部分。Payment执行业务逻辑并操作完数据库后，就会把自己的事务注册到<code>事务协调器TC</code>，作为这个<code>XID</code>下面的一个分支事务，同时将执行结果（成功或失败）也返回给<code>事务协调器TC</code>。注意，这里只是执行成功了，但事务并未提交，此时Payment的角色为<code>资源管理者RM</code>，这里的资源指的就是本地数据库。另外两个微服务Order、Inventory的事务执行逻辑与Payment是一样的。</p></li><li><p>在各个微服务都执行完成之后，<code>事务协调器TC</code>就知道了<code>XID</code>下各个分支事务的执行结果，<code>事务管理者TM</code>和业务调用方也会一并知晓。<code>事务管理者TM</code>如果发现各个微服务的分支事务都执行成功的话，就会请求<code>事务协调器TC</code>提交这个<code>XID</code>，否则回滚。<code>事务协调器TC</code>收到业务调用方的请求后，向<code>XID</code>下所有的分支事务发起相应请求。各个微服务收到请求后执行相应指令，并把结果上报给<code>事务协调器TC</code>。</p></li></ul><p><a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>从理论上面来说，吸收和借鉴了之前的<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>及其衍生出来的<a href="https://en.wikipedia.org/wiki/Three-phase_commit_protocol" target="_blank" rel="noopener noreferrer">3PC</a>和<a href="https://seata.apache.org/zh-cn/blog/tcc-mode-design-principle/" target="_blank" rel="noopener noreferrer">TCC</a>等方案中的优点，并对其不足做了相应改进。</p><figure><img src="https://tianmazuo.com/technology/distributed/distributed-26.png" alt="Seata借鉴吸收了其他分布式事务解决方案的优点" tabindex="0" loading="lazy"><figcaption>Seata借鉴吸收了其他分布式事务解决方案的优点</figcaption></figure><p>因此，<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>支持四种模式。</p><ul><li><p><a href="https://seata.apache.org/zh-cn/docs/user/mode/at" target="_blank" rel="noopener noreferrer">AT模式</a>：它是一种自定义的<a href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="noopener noreferrer">2PC</a>。</p></li><li><p><a href="https://seata.apache.org/zh-cn/docs/user/mode/tcc" target="_blank" rel="noopener noreferrer">TCC模式</a>：它是用<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>来实现的<a href="https://seata.apache.org/zh-cn/blog/tcc-mode-design-principle/" target="_blank" rel="noopener noreferrer">TCC</a>。</p></li><li><p><a href="https://seata.apache.org/zh-cn/docs/user/mode/saga" target="_blank" rel="noopener noreferrer">Saga模式</a>：是<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>提供的<a href="https://en.wikipedia.org/wiki/Long-running_transaction" target="_blank" rel="noopener noreferrer">长事务</a>解决方案。</p></li><li><p><a href="https://seata.apache.org/zh-cn/docs/user/mode/xa" target="_blank" rel="noopener noreferrer">XA模式</a>：是<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>实现的<a href="https://en.wikipedia.org/wiki/X/Open_XA" target="_blank" rel="noopener noreferrer">XA协议</a>。</p></li></ul><div class="hint-container warning"><p class="hint-container-title">官方提供的资源</p><ul><li><p><a href="https://seata.apache.org/zh-cn/docs/user/quickstart" target="_blank" rel="noopener noreferrer">快速开始</a></p></li><li><p><a href="https://github.com/apache/incubator-seata/releases" target="_blank" rel="noopener noreferrer">服务器软件</a></p></li><li><p><a href="https://github.com/apache/incubator-seata-samples/tree/master" target="_blank" rel="noopener noreferrer">样例代码</a></p></li><li><p><a href="https://seata.apache.org/zh-cn/docs/user/configurations" target="_blank" rel="noopener noreferrer">各种参数配置项的详细说明</a></p></li></ul></div><p>以<a href="https://seata.apache.org/zh-cn/docs/user/mode/at" target="_blank" rel="noopener noreferrer">AT模式</a>为例，它的实现过程如下。</p><h3 id="准备环境" tabindex="-1"><a class="header-anchor" href="#准备环境"><span>准备环境</span></a></h3>`,105),o=a('<li><p>官方用多种方式实现了<a href="https://github.com/apache/incubator-seata-samples/tree/master/at-sample" target="_blank" rel="noopener noreferrer">AT模式</a>，例如<a href="https://github.com/apache/incubator-seata-samples/tree/master/at-sample/dubbo-samples-seata" target="_blank" rel="noopener noreferrer">Dubbo方式</a>、<a href="https://github.com/apache/incubator-seata-samples/tree/master/at-sample/springboot-seata" target="_blank" rel="noopener noreferrer">Spring Boot方式</a>和<a href="https://github.com/apache/incubator-seata-samples/tree/master/at-sample/springboot-dubbo-seata" target="_blank" rel="noopener noreferrer">Spring Boot Dubbo方式</a>等，选择其中一种（这里选择<a href="https://github.com/apache/incubator-seata-samples/tree/master/at-sample/springboot-seata" target="_blank" rel="noopener noreferrer">Spring Boot方式</a>）。</p></li><li><p><code>Clone</code>或下载代码，然后导入到<a href="https://www.jetbrains.com/idea/" target="_blank" rel="noopener noreferrer">IDEA</a>。</p></li><li><p>在<a href="https://github.com/apache/incubator-seata/releases" target="_blank" rel="noopener noreferrer">这里</a>下载<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>服务端组件包。</p></li>',3),g=a(`<h3 id="服务配置" tabindex="-1"><a class="header-anchor" href="#服务配置"><span>服务配置</span></a></h3><p><code>seata-server/conf/</code>里面包含了服务端和日志的所有相关配置。</p><ul><li><p><code>application.example.yml</code>：<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>服务端配置的样例文件。</p></li><li><p><code>application.raft.example.yml</code>：使用<a href="https://zh.wikipedia.org/wiki/Raft" target="_blank" rel="noopener noreferrer">Raft</a>事务存储模式的服务端配置样例文件。</p></li><li><p><code>application.yml</code>：<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>的服务端配置文件，这个是真正用来配置服务端的。</p></li><li><p><code>logback-spring.xml</code>：<a href="https://logback.qos.ch/" target="_blank" rel="noopener noreferrer">Logback</a>日志配置文件。</p></li><li><p><code>logback目录</code>：提供了多种日志输出的配置示例，例如输出到<code>控制台</code>、<code>文件</code>、<a href="https://kafka.apache.org/" target="_blank" rel="noopener noreferrer">Kafka</a>、<a href="https://www.elastic.co/logstash" target="_blank" rel="noopener noreferrer">Logstash</a>等。</p></li></ul><p>可以按照需求修改<code>seata-server/conf/application.yml</code>文件，也可以什么都不改，采用默认配置。</p><p>另外，<code>application.yml</code>中的<code>console.user</code>是<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a><code>Web UI</code>的默认用户名和密码。</p><h3 id="修改代码" tabindex="-1"><a class="header-anchor" href="#修改代码"><span>修改代码</span></a></h3><ul><li><p>执行<code>src/main/resources/all.sql</code>脚本文件，创建客户端所需的业务表和系统表。</p></li><li><p>如果<code>src/main/resources/registry.conf</code>的<code>type = &quot;file&quot;</code>，那就要修改<code>src/main/resources/file.conf</code>，将其中的<code>default.grouplist</code>改为正确的<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>服务端<code>IP</code>地址，端口号默认是<code>8091</code>（就是官方说的<code>7091 + 1000</code>）。</p></li><li><p>修改<code>src/main/resources/application.properties</code>属性文件中的数据库连接配置。</p></li></ul><h3 id="启动服务" tabindex="-1"><a class="header-anchor" href="#启动服务"><span>启动服务</span></a></h3><ul><li>首先启动<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>服务端。</li></ul><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cd seata-server/bin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 启动服务</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; sh ./seata-server.sh -p 8091 -h &lt;服务器IP&gt; -m file</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 服务启动后可以在/root/logs/seata/中查看启动日志</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; tail -f /root/logs/seata/seata-server.8091.all.log </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023-06-22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 21:37:02.034</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  INFO</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ServerHandlerThread_1_2_500] [io.seata.server.coordinator.DefaultCoordinator] [doGlobalBegin] [172.16.185.176:8091:5260755181745868801]: Begin new global transaction applicationId: springboot-seata,transactionServiceGroup: my_test_tx_group, transactionName: spring-seata-tx,timeout:300000,xid:172.16.185.176:8091:5260755181745868801</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023-06-22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 21:37:02.036</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  INFO</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [batchLoggerPrint_1_1] [io.seata.core.rpc.processor.server.BatchLogHandler] [run] []: result msg[single]: GlobalBeginResponse{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xid</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;172.16.185.176:8091:5260755181745868801&#39;,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> extraData</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;null&#39;,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resultCode</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Success,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;null&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}, clientIp: 172.16.185.1, vgroup: my_test_tx_group</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023-06-22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 21:37:02.657</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  INFO</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [batchLoggerPrint_1_1] [io.seata.core.rpc.processor.server.BatchLogHandler] [run] []: receive msg[merged]: BranchRegisterRequest{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xid</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;172.16.185.176:8091:5260755181745868801&#39;,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> branchType</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">AT,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resourceId</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;jdbc:mysql://172.16.185.176:3306/seata&#39;,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> lockKey</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;order_tbl:1&#39;,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> applicationData</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{&quot;skipCheckLock&quot;:true}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}, clientIp: 172.16.185.1, vgroup: my_test_tx_group</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023-06-22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 21:37:02.669</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  INFO</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ForkJoinPool.commonPool-worker-2] [io.seata.server.coordinator.AbstractCore] [lambda</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$branchRegister</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">$0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] [172.16.185.176:8091:5260755181745868801]: Register branch successfully, xid = 172.16.185.176:8091:5260755181745868801, branchId = 5260755181745868802, resourceId = jdbc:mysql://172.16.185.176:3306/seata ,lockKeys = order_tbl:1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023-06-22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 21:37:02.670</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  INFO</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [batchLoggerPrint_1_1] [io.seata.core.rpc.processor.server.BatchLogHandler] [run] []: result msg[merged]: BranchRegisterResponse{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">branchId</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">5260755181745868802,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resultCode</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Success,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;null&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}, clientIp: 172.16.185.1, vgroup: my_test_tx_group</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023-06-22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 21:37:02.771</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  INFO</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [batchLoggerPrint_1_1] [io.seata.core.rpc.processor.server.BatchLogHandler] [run] []: receive msg[single]: GlobalCommitRequest{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xid</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;172.16.185.176:8091:5260755181745868801&#39;,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> extraData</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;null&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}, clientIp: 172.16.185.1, vgroup: my_test_tx_group</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023-06-22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 21:37:02.777</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  INFO</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [batchLoggerPrint_1_1] [io.seata.core.rpc.processor.server.BatchLogHandler] [run] []: result msg[single]: GlobalCommitResponse{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">globalStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Committed,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resultCode</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Success,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;null&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}, clientIp: 172.16.185.1, vgroup: my_test_tx_group</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023-06-22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 21:37:03.596</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  INFO</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [batchLoggerPrint_1_1] [io.seata.core.rpc.processor.server.BatchLogHandler] [run] []: receive msg[single]: BranchCommitResponse{</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xid</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;172.16.185.176:8091:5260755181745868801&#39;,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> branchId</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">5260755181745868802,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> branchStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">PhaseTwo_Committed,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> resultCode</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Success,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> msg</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;null&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}, clientIp: 172.16.185.1, vgroup: my_test_tx_group</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023-06-22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 21:37:03.597</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  INFO</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [AsyncCommitting_1_1] [io.seata.server.coordinator.DefaultCore] [lambda</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$doGlobalCommit</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">$1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] [172.16.185.176:8091:5260755181745868801]: Commit branch transaction successfully, xid = 172.16.185.176:8091:5260755181745868801 branchId = 5260755181745868802</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023-06-22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 21:37:03.599</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  INFO</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [AsyncCommitting_1_1] [io.seata.server.coordinator.DefaultCore] [doGlobalCommit] [172.16.185.176:8091:5260755181745868801]: Committing global transaction is successfully done, xid = 172.16.185.176:8091:5260755181745868801.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在浏览器中访问<a href="http://xn--IP-fr5c86lx7z:7091/" target="_blank" rel="noopener noreferrer">http://服务器IP:7091/</a>，输入在<code>application.yml</code>中设置的用户名和密码，就可以看到<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>的<code>Web UI</code>了。</p><figure><img src="https://tianmazuo.com/technology/distributed/distributed-27.png" alt="Seata Web UI" tabindex="0" loading="lazy"><figcaption>Seata Web UI</figcaption></figure><ul><li>然后启动<a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">Seata</a>客户端代码，也就是运行<a href="https://github.com/apache/incubator-seata-samples/tree/master/at-sample/springboot-seata" target="_blank" rel="noopener noreferrer">Spring Boot</a>中的<code>SpringbootSeataApplication</code>服务。</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[] args) throws Exception {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    SpringApplication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">SpringbootSeataApplication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, args);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    BusinessService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> businessService </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> BEAN_FACTORY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBean</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">BusinessService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 服务启动后立即在子线程中执行businessService.purchase()方法</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Thread</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> thread </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> businessService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">purchase</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;U100001&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;C00321&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    //keep run</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行结果如下。</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">09.789</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  io</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">tm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">TransactionManagerHolder</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TransactionManager</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Singleton</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> io</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">tm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">DefaultTransactionManager</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">7fdc6c4f</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">09.798</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">tm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">api</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">DefaultGlobalTransaction</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Begin</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> global transaction [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">172.16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">185</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">176</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8091</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5260755181745868803</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">09.803</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">BusinessService</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> purchase begin </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> xid</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 172.16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">185</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">176</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8091</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5260755181745868803</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">09.803</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">StorageService</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Stock</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Service</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Begin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ...</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> xid</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 172.16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">185</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">176</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8091</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5260755181745868803</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">09.803</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">StorageService</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Deducting</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> inventory SQL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> update stock_tbl set count </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> count </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> where commodity_code </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> C00321</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10.186</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">StorageService</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Stock</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Service</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> End</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ...</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10.187</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">apache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">OrderService</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Order</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Service</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Begin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ...</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> xid</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 172.16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">185</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">176</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8091</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5260755181745868803</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10.187</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">AccountService</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Account</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ...</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> xid</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 172.16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">185</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">176</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8091</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5260755181745868803</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10.187</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">AccountService</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Deducting</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> balance SQL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> update account_tbl set money </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> money </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 400</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> where user_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> U100001</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10.203</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">AccountService</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Account</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Service</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> End</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ...</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10.204</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  o</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">apache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">OrderService</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Order</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Service</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> SQL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> insert into </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">order_tbl</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (user_id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> commodity_code</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> money) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">values</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (U100001</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> C00321</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 400</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10.296</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  io</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">AbstractResourceManager</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> branch register success</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> xid</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">172.16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">185</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">176</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8091</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5260755181745868803</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> branchId</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5260755181745868804</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> lockKeys</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">order_tbl</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10.304</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">WARN</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">l</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">EnhancedServiceLoader$InnerEnhancedServiceLoader</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Load</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">io</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">datasource</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">undo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">parser</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ProtostuffUndoLogParser</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> fail</span><span style="--shiki-light:#C18401;--shiki-dark:#E06C75;">: io/protostuff/runtime/IdStrategy</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E06C75;">2023-06-22 21:39:10.358 [Thread-1] INFO  o.apache.seata.service.OrderService - Order Service End ... Created 2</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E06C75;">2023-06-22 21:39:10.358 [Thread-1] INFO  i.s.tm.api.DefaultGlobalTransaction - transaction 172.16.185.176:8091:5260755181745868803 will be commit</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E06C75;">2023-06-22 21:39:10.362 [Thread-1] INFO  i.s.tm.api.DefaultGlobalTransaction - transaction end, xid = 172.16.185.176:8091:5260755181745868803</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E06C75;">2023-06-22 21:39:10.362 [Thread-1] INFO  i.s.tm.api.DefaultGlobalTransaction - [172.16.185.176:8091:5260755181745868803] commit status: Committed</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E06C75;">2023-06-22 21:39:11.156 [rpcDispatch_RMROLE_1_1_32] INFO  i.s.c.r.p.c.RmBranchCommitProcessor - rm client handle branch commit process:BranchCommitRequest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">xid</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;172.16.185.176:8091:5260755181745868803&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> branchId</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5260755181745868804</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> branchType</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">AT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> resourceId</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;jdbc:mysql://172.16.185.176:3306/seata&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> applicationData</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{&quot;skipCheckLock&quot;:true}&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">11.157</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [rpcDispatch_RMROLE_1_1_32] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  io</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">AbstractRMHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Branch</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> committing</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 172.16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">185</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">176</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8091</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5260755181745868803</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5260755181745868804</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> jdbc</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">mysql</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//172.16.185.176:3306/seata {&quot;skipCheckLock&quot;:true}</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2023</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">06</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 21</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">39</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">11.158</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [rpcDispatch_RMROLE_1_1_32] </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">INFO</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  io</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">AbstractRMHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Branch</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> commit result</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> PhaseTwo_Committed</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16);function c(A,y){const e=n("RouteLink");return r(),h("div",null,[d,i("ul",null,[i("li",null,[i("p",null,[s("使用已有的环境："),l(e,{to:"/technology/database/mysql/docker.html"},{default:k(()=>[s("Docker部署MySQL")]),_:1}),s("。")])]),o]),g])}const E=t(p,[["render",c],["__file","transaction.html.vue"]]),u=JSON.parse('{"path":"/technology/distributed/transaction.html","title":"事务","lang":"zh-CN","frontmatter":{"title":"事务","icon":"atom","category":["分布式","事务"],"tag":["分布式","事务"],"date":"2023-06-22T00:00:00.000Z","isOriginal":true,"star":true,"description":"单机事务 所谓单机事务指的就是事务，它具有原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）和持久性（Durability/Permanence）。 执行事务的时候，一般以BEGIN开头，以END结尾，中间要么COMMIT TRANSACTION，要么ROLLBACK TRANSACTION。 下面是实现事务的...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/technology/distributed/transaction.html"}],["meta",{"property":"og:site_name","content":"添码座"}],["meta",{"property":"og:title","content":"事务"}],["meta",{"property":"og:description","content":"单机事务 所谓单机事务指的就是事务，它具有原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）和持久性（Durability/Permanence）。 执行事务的时候，一般以BEGIN开头，以END结尾，中间要么COMMIT TRANSACTION，要么ROLLBACK TRANSACTION。 下面是实现事务的..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://tianmazuo.com/technology/distributed/distributed-10.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"添码座"}],["meta",{"property":"article:tag","content":"分布式"}],["meta",{"property":"article:tag","content":"事务"}],["meta",{"property":"article:published_time","content":"2023-06-22T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"事务\\",\\"image\\":[\\"https://tianmazuo.com/technology/distributed/distributed-10.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-11.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-12.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-13.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-14.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-15.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-16.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-17.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-18.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-20.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-21.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-22.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-23.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-24.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-25.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-26.png\\",\\"https://tianmazuo.com/technology/distributed/distributed-27.png\\"],\\"datePublished\\":\\"2023-06-22T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"添码座\\",\\"url\\":\\"https://www.tianmazuo.com/about/\\"}]}"]]},"headers":[{"level":2,"title":"单机事务","slug":"单机事务","link":"#单机事务","children":[]},{"level":2,"title":"分布式事务","slug":"分布式事务","link":"#分布式事务","children":[{"level":3,"title":"定理一：CAP","slug":"定理一-cap","link":"#定理一-cap","children":[]},{"level":3,"title":"定理二：BASE","slug":"定理二-base","link":"#定理二-base","children":[]},{"level":3,"title":"2PC","slug":"_2pc","link":"#_2pc","children":[]},{"level":3,"title":"3PC","slug":"_3pc","link":"#_3pc","children":[]},{"level":3,"title":"TCC","slug":"tcc","link":"#tcc","children":[]},{"level":3,"title":"本地消息表","slug":"本地消息表","link":"#本地消息表","children":[]},{"level":3,"title":"可靠消息最终一致性","slug":"可靠消息最终一致性","link":"#可靠消息最终一致性","children":[]}]},{"level":2,"title":"Saga","slug":"saga","link":"#saga","children":[]},{"level":2,"title":"Seata","slug":"seata","link":"#seata","children":[{"level":3,"title":"准备环境","slug":"准备环境","link":"#准备环境","children":[]},{"level":3,"title":"服务配置","slug":"服务配置","link":"#服务配置","children":[]},{"level":3,"title":"修改代码","slug":"修改代码","link":"#修改代码","children":[]},{"level":3,"title":"启动服务","slug":"启动服务","link":"#启动服务","children":[]}]}],"git":{},"readingTime":{"minutes":23.97,"words":7190},"filePathRelative":"technology/distributed/transaction.md","localizedDate":"2023年6月22日","excerpt":"<h2>单机事务</h2>\\n<p>所谓<code>单机事务</code>指的就是<a href=\\"https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">事务</a>，它具有<code>原子性（Atomicity）</code>、<code>一致性（Consistency）</code>、<code>隔离性（Isolation）</code>和<code>持久性（Durability/Permanence）</code>。</p>","autoDesc":true}');export{E as comp,u as data};
