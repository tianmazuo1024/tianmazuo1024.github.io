import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,o as e,d as a}from"./app-B5m7CcSj.js";const n={},t=a(`<p>两台虚拟机能够互相<code>ping</code>通。</p><ul><li><p><code>虚拟机1</code>：<code>172.16.185.166</code></p></li><li><p><code>虚拟机2</code>：<code>172.16.185.130</code></p></li></ul><figure><img src="https://tianmazuo.com/technology/cicd/docker/docker-10.png" alt="两台虚拟机" tabindex="0" loading="lazy"><figcaption>两台虚拟机</figcaption></figure><p>现在需要实现如下目的。</p><ul><li><p><code>宿主机2</code>能够访问<code>宿主机1</code>中的<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>服务。</p></li><li><p><code>宿主机2</code>中的<a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">Docker</a>能够访问<code>宿主机1</code>中的<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>服务。</p></li></ul><figure><img src="https://tianmazuo.com/technology/cicd/docker/docker-11.png" alt="docker互访" tabindex="0" loading="lazy"><figcaption>docker互访</figcaption></figure><p>这必须借助端口转发才能完成。</p><p>创建容器<code>web2</code>，将宿主机的<code>8080</code>端口映射到容器的<code>80</code>端口上：<code>-p [宿主机端口]:[容器端口]</code>。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; docker run -d -p 8080:80 --name web2 --network mynet nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查看<code>web2</code>的<code>ip</code>地址。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; docker inspect web2</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">......</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;Networks&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    &quot;mynet&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;IPAMConfig&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> null,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;Links&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> null,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;Aliases&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            &quot;db317495c64f&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ],</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;NetworkID&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;7984433eed3c720ccc84890d75a31ee922366a5e6dd097a0977a9ca726f075f7&quot;,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;EndpointID&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;ca71520537eaa8063d474d2809a0151f56b253228ebf49beb70d1c0fc53e1034&quot;,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;Gateway&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;172.19.0.1&quot;,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;IPAddress&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;172.19.0.4&quot;,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;IPPrefixLen&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 16,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;IPv6Gateway&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;GlobalIPv6Address&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;GlobalIPv6PrefixLen&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;MacAddress&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;02:42:ac:13:00:04&quot;,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        &quot;DriverOpts&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> null</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>宿主机1</code>上通过容器<code>IP</code>访问<a href="https://www.nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a>服务。</p><figure><img src="https://tianmazuo.com/technology/cicd/docker/docker-12.png" alt="通过容器IP访问nginx服务" tabindex="0" loading="lazy"><figcaption>通过容器IP访问nginx服务</figcaption></figure><p>在<code>宿主机1</code>上通过宿主机<code>IP</code>访问。</p><figure><img src="https://tianmazuo.com/technology/cicd/docker/docker-13.png" alt="通过宿主机IP访问" tabindex="0" loading="lazy"><figcaption>通过宿主机IP访问</figcaption></figure><figure><img src="https://tianmazuo.com/technology/cicd/docker/docker-14.png" alt="通过宿主机本机IP访问" tabindex="0" loading="lazy"><figcaption>通过宿主机本机IP访问</figcaption></figure><p>在<code>宿主机2</code>上通过<code>宿主机1</code>的<code>IP</code>访问。</p><figure><img src="https://tianmazuo.com/technology/cicd/docker/docker-15.png" alt="通过宿主机本机IP访问" tabindex="0" loading="lazy"><figcaption>通过宿主机本机IP访问</figcaption></figure><p>在虚拟机外部的<code>MacBook</code>上访问。</p><figure><img src="https://tianmazuo.com/technology/cicd/docker/docker-16.png" alt="通过宿主机本机IP访问" tabindex="0" loading="lazy"><figcaption>通过宿主机本机IP访问</figcaption></figure><p>端口转发。</p><figure><img src="https://tianmazuo.com/technology/cicd/docker/docker-17.png" alt="端口转发" tabindex="0" loading="lazy"><figcaption>端口转发</figcaption></figure><p>查看<code>iptables</code>的转发规则。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; iptables -t nat -nvxL</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://tianmazuo.com/technology/cicd/docker/docker-18.png" alt="端口转发" tabindex="0" loading="lazy"><figcaption>端口转发</figcaption></figure><ul><li><p>问题：如果docker命令使用端口转发-p参数，那么在Dockerfile中是否还需要通过EXPOSE来暴露端口？</p></li><li><p>答案：不需要。<code>EXPOSE</code>语法的作用实际上更多是解释说明的作用。也就是说，<code>EXPOSE</code>起不到端口转发的作用。但是如果没有它，那么初次使用镜像的用户就不知道该通过哪个端口访问服务了。</p></li></ul><figure><img src="https://tianmazuo.com/technology/cicd/docker/docker-19.png" alt="暴露端口" tabindex="0" loading="lazy"><figcaption>暴露端口</figcaption></figure><p>有这样一个<code>Dockerfile</code>。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python:3.9.5-slim</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flask</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /src</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FLASK=app.py</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">COPY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> app.py</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /src/app.py</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># EXPOSE 2024</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;flask&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;run&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;h&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;0.0.0.0&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果取消掉<code>EXPOSE</code>的注释，那么在通过<code>inspect</code>指令查看时会发现多出了一个<code>&quot;ExposedPorts&quot;:{&quot;2024/tcp&quot;:{}}</code>的属性值。</p>`,30),l=[t];function o(c,d){return e(),s("div",null,l)}const h=i(n,[["render",o],["__file","docker-port-forward.html.vue"]]),k=JSON.parse('{"path":"/technology/cicd/docker/docker-port-forward.html","title":"端口转发","lang":"zh-CN","frontmatter":{"title":"端口转发","icon":"inbox","category":["CI&CD","Docker"],"tag":["CI&CD","Docker"],"date":"2022-10-19T00:00:00.000Z","isOriginal":true,"star":true,"description":"两台虚拟机能够互相ping通。 虚拟机1：172.16.185.166 虚拟机2：172.16.185.130 两台虚拟机两台虚拟机 现在需要实现如下目的。 宿主机2能够访问宿主机1中的Nginx服务。 宿主机2中的Docker能够访问宿主机1中的Nginx服务。 docker互访docker互访 这必须借助端口转发才能完成。 创建容器web2，将宿主...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/technology/cicd/docker/docker-port-forward.html"}],["meta",{"property":"og:site_name","content":"添码座"}],["meta",{"property":"og:title","content":"端口转发"}],["meta",{"property":"og:description","content":"两台虚拟机能够互相ping通。 虚拟机1：172.16.185.166 虚拟机2：172.16.185.130 两台虚拟机两台虚拟机 现在需要实现如下目的。 宿主机2能够访问宿主机1中的Nginx服务。 宿主机2中的Docker能够访问宿主机1中的Nginx服务。 docker互访docker互访 这必须借助端口转发才能完成。 创建容器web2，将宿主..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://tianmazuo.com/technology/cicd/docker/docker-10.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"添码座"}],["meta",{"property":"article:tag","content":"CI&CD"}],["meta",{"property":"article:tag","content":"Docker"}],["meta",{"property":"article:published_time","content":"2022-10-19T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"端口转发\\",\\"image\\":[\\"https://tianmazuo.com/technology/cicd/docker/docker-10.png\\",\\"https://tianmazuo.com/technology/cicd/docker/docker-11.png\\",\\"https://tianmazuo.com/technology/cicd/docker/docker-12.png\\",\\"https://tianmazuo.com/technology/cicd/docker/docker-13.png\\",\\"https://tianmazuo.com/technology/cicd/docker/docker-14.png\\",\\"https://tianmazuo.com/technology/cicd/docker/docker-15.png\\",\\"https://tianmazuo.com/technology/cicd/docker/docker-16.png\\",\\"https://tianmazuo.com/technology/cicd/docker/docker-17.png\\",\\"https://tianmazuo.com/technology/cicd/docker/docker-18.png\\",\\"https://tianmazuo.com/technology/cicd/docker/docker-19.png\\"],\\"datePublished\\":\\"2022-10-19T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"添码座\\",\\"url\\":\\"https://www.tianmazuo.com/about/\\"}]}"]]},"headers":[],"git":{},"readingTime":{"minutes":1.81,"words":543},"filePathRelative":"technology/cicd/docker/docker-port-forward.md","localizedDate":"2022年10月19日","excerpt":"<p>两台虚拟机能够互相<code>ping</code>通。</p>\\n<ul>\\n<li>\\n<p><code>虚拟机1</code>：<code>172.16.185.166</code></p>\\n</li>\\n<li>\\n<p><code>虚拟机2</code>：<code>172.16.185.130</code></p>\\n</li>\\n</ul>\\n<figure><img src=\\"https://tianmazuo.com/technology/cicd/docker/docker-10.png\\" alt=\\"两台虚拟机\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption>两台虚拟机</figcaption></figure>","autoDesc":true}');export{h as comp,k as data};
