var z=Object.defineProperty;var U=n=>{throw TypeError(n)};var A=(n,r,e)=>r in n?z(n,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[r]=e;var w=(n,r,e)=>A(n,typeof r!="symbol"?r+"":r,e),I=(n,r,e)=>r.has(n)||U("Cannot "+e);var s=(n,r,e)=>(I(n,r,"read from private field"),e?e.call(n):r.get(n)),p=(n,r,e)=>r.has(n)?U("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(n):r.set(n,e),l=(n,r,e,t)=>(I(n,r,"write to private field"),t?t.call(n,e):r.set(n,e),e),o=(n,r,e)=>(I(n,r,"access private method"),e);import{av as G,s as H,aI as J,l as K,k as Q,b1 as W,aO as X,am as Z,an as V,b0 as j,t as ee}from"./app-B5m7CcSj.js";import{E as te}from"./vidstack-O8cuP9CY-D6xp1AwU.js";import{resolveYouTubeVideoId as se}from"./vidstack-Zc3I7oOd-CA6XwpqT.js";const f={Unstarted:-1,Ended:0,Playing:1,Paused:2,Buffering:3,Cued:5};var a,v,k,S,P,b,g,i,M,B,Y,m,F,x,L,O,C,N,q,_,T;class re extends te{constructor(e,t){super(e);p(this,i);w(this,"$$PROVIDER_TYPE","YOUTUBE");w(this,"scope",G());p(this,a);p(this,v,H(""));p(this,k,-1);p(this,S,null);p(this,P,-1);p(this,b,!1);p(this,g,new Map);w(this,"language","en");w(this,"color","red");w(this,"cookies",!1);l(this,a,t)}get currentSrc(){return s(this,S)}get type(){return"youtube"}get videoId(){return s(this,v).call(this)}preconnect(){J(this.getOrigin())}setup(){super.setup(),K(o(this,i,Y).bind(this)),s(this,a).notify("provider-setup",this)}destroy(){o(this,i,_).call(this);const e="provider destroyed";for(const t of s(this,g).values())for(const{reject:d}of t)d(e);s(this,g).clear()}async play(){return o(this,i,m).call(this,"playVideo")}async pause(){return o(this,i,m).call(this,"pauseVideo")}setMuted(e){e?o(this,i,m).call(this,"mute"):o(this,i,m).call(this,"unMute")}setCurrentTime(e){l(this,b,s(this,a).$state.paused()),o(this,i,m).call(this,"seekTo",e),s(this,a).notify("seeking",e)}setVolume(e){o(this,i,m).call(this,"setVolume",e*100)}setPlaybackRate(e){o(this,i,m).call(this,"setPlaybackRate",e)}async loadSource(e){if(!Q(e.src)){l(this,S,null),s(this,v).set("");return}const t=se(e.src);s(this,v).set(t??""),l(this,S,e)}getOrigin(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}buildParams(){const{keyDisabled:e}=s(this,a).$props,{muted:t,playsInline:d,nativeControls:h}=s(this,a).$state,u=h();return{autoplay:0,cc_lang_pref:this.language,cc_load_policy:u?1:void 0,color:this.color,controls:u?1:0,disablekb:!u||e()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:u?1:3,mute:t()?1:0,playsinline:d()?1:0}}onLoad(){window.setTimeout(()=>this.postMessage({event:"listening"}),100)}onMessage({info:e},t){var c;if(!e)return;const{title:d,intrinsicDuration:h,playbackRate:u}=s(this,a).$state;if(Z(e.videoData)&&e.videoData.title!==d()&&s(this,a).notify("title-change",e.videoData.title,t),V(e.duration)&&e.duration!==h()){if(V(e.videoLoadedFraction)){const y=((c=e.progressState)==null?void 0:c.loaded)??e.videoLoadedFraction*e.duration,$=new j(0,e.duration);o(this,i,O).call(this,y,$,t)}s(this,a).notify("duration-change",e.duration,t)}if(V(e.playbackRate)&&e.playbackRate!==u()&&s(this,a).notify("rate-change",e.playbackRate,t),e.progressState){const{current:y,seekableStart:$,seekableEnd:E,loaded:R,duration:D}=e.progressState;o(this,i,L).call(this,y,t),o(this,i,O).call(this,R,new j($,E),t),D!==h()&&s(this,a).notify("duration-change",D,t)}if(V(e.volume)&&ee(e.muted)){const y={muted:e.muted,volume:e.volume/100};s(this,a).notify("volume-change",y,t)}V(e.playerState)&&e.playerState!==s(this,k)&&o(this,i,q).call(this,e.playerState,t)}}a=new WeakMap,v=new WeakMap,k=new WeakMap,S=new WeakMap,P=new WeakMap,b=new WeakMap,g=new WeakMap,i=new WeakSet,M=function(e){var t;(t=o(this,i,T).call(this,"playVideo"))==null||t.reject(e)},B=function(e){var t;(t=o(this,i,T).call(this,"pauseVideo"))==null||t.reject(e)},Y=function(){o(this,i,_).call(this);const e=s(this,v).call(this);if(!e){this.src.set("");return}this.src.set(`${this.getOrigin()}/embed/${e}`),s(this,a).notify("load-start")},m=function(e,t){let d=W(),h=s(this,g).get(e);return h||s(this,g).set(e,h=[]),h.push(d),this.postMessage({event:"command",func:e,args:t?[t]:void 0}),d.promise},F=function(e){s(this,a).notify("loaded-metadata"),s(this,a).notify("loaded-data"),s(this,a).delegate.ready(void 0,e)},x=function(e){var t;(t=o(this,i,T).call(this,"pauseVideo"))==null||t.resolve(),s(this,a).notify("pause",void 0,e)},L=function(e,t){const{duration:d,realCurrentTime:h}=s(this,a).$state,u=s(this,k)===f.Ended,c=u?d():e;s(this,a).notify("time-change",c,t),!u&&Math.abs(c-h())>1&&s(this,a).notify("seeking",c,t)},O=function(e,t,d){const h={buffered:new j(0,e),seekable:t};s(this,a).notify("progress",h,d);const{seeking:u,realCurrentTime:c}=s(this,a).$state;u()&&e>c()&&o(this,i,C).call(this,d)},C=function(e){const{paused:t,realCurrentTime:d}=s(this,a).$state;window.clearTimeout(s(this,P)),l(this,P,window.setTimeout(()=>{s(this,a).notify("seeked",d(),e),l(this,P,-1)},t()?100:0)),l(this,b,!1)},N=function(e){const{seeking:t}=s(this,a).$state;t()&&o(this,i,C).call(this,e),s(this,a).notify("pause",void 0,e),s(this,a).notify("end",void 0,e)},q=function(e,t){var R;const{started:d,paused:h,seeking:u}=s(this,a).$state,c=e===f.Playing,y=e===f.Buffering,$=!X(o(this,i,T).call(this,"playVideo")),E=(h()||$)&&(y||c);if(y&&s(this,a).notify("waiting",void 0,t),u()&&c&&o(this,i,C).call(this,t),!d()&&E&&s(this,b)){o(this,i,M).call(this,"invalid internal play operation"),c&&(this.pause(),l(this,b,!1));return}switch(E&&((R=o(this,i,T).call(this,"playVideo"))==null||R.resolve(),s(this,a).notify("play",void 0,t)),e){case f.Unstarted:o(this,i,M).call(this,"provider rejected"),o(this,i,B).call(this,"provider rejected"),s(this,a).notify("pause",void 0,t);break;case f.Cued:o(this,i,F).call(this,t);break;case f.Playing:s(this,a).notify("playing",void 0,t);break;case f.Paused:o(this,i,x).call(this,t);break;case f.Ended:o(this,i,N).call(this,t);break}l(this,k,e)},_=function(){l(this,k,-1),l(this,P,-1),l(this,b,!1)},T=function(e){var t;return(t=s(this,g).get(e))==null?void 0:t.shift()};export{re as YouTubeProvider};
